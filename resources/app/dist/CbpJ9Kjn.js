import{d as ye,r as p,t as u,v as h,z as e,A as n,aB as ne,B as d,y as _,N as o,ax as Me,L as g,R as B,Q as K,aC as rn,X as ue,ab as ge,a4 as we,Y as Ce,aD as un,Z as he,aE as dn,a2 as be,au as ke,aF as cn,aG as pn,ap as Ve,ac as Te,W as Fe,aH as Ee,C as Be,D as ze,x as W,_ as Se,aI as fn,aJ as mn,aK as _n,aL as vn,c as oe,aM as Z,K as In,aN as yn,aO as gn,aP as wn,aQ as Cn,aR as hn,O as te,aS as ie,az as Pe,P as re,aT as Ne,aU as ve,aV as bn,aW as kn,at as Vn,ar as Tn,aX as Fn,a0 as Ae,a5 as Sn,a6 as Oe,a9 as je,a3 as Ke,af as We,a1 as qe,m as Ge,aY as Ln,o as Rn,M as $n,as as Un,aj as Dn,a8 as Hn,aw as Mn,aZ as En}from"./0fV2q4Ox.js";import{_ as Bn}from"./logout.js";import{c as zn,d as Qe,u as Pn,e as Nn}from"./M_3S_cE4.js";import{c as Ie,u as An,p as Ye,i as Xe,h as He}from"./D0r5xylr.js";import"./BYx_WZxC.js";const On=v=>(Be("data-v-697993b6"),v=v(),ze(),v),jn=On(()=>W("p",{class:"ion-text-center"},"Nothing to select",-1)),Kn=ye({__name:"typeahead",props:{items:Array,selectedItems:Array,getItemValue:{type:Function,default:v=>v.value},getItemText:{type:Function,default:v=>v.text},renderItem:{type:Function},title:{type:String,default:"Select Items"},allowMultiple:{type:Boolean,default:!0}},emits:["selection-cancel","selection-change"],setup(v,{emit:D}){const s=v,z=D,S=p([...s.items]),b=p([...s.selectedItems]),L=a=>b.value.find(i=>i===a)!==void 0,A=()=>z("selection-cancel"),k=()=>z("selection-change",b.value),m=a=>I(a.target.value),I=a=>{var i;if(!a)S.value=[...s.items];else{const f=a.toLowerCase();S.value=((i=s.items)==null?void 0:i.filter(w=>s.getItemText(w).toLowerCase().includes(f)))??[]}},q=a=>{const{checked:i,value:f}=a.detail;i?b.value=[...b.value,f]:b.value=b.value.filter(w=>w!==f)},O=a=>{const{value:i}=a.detail;b.value=[i]};return(a,i)=>{const f=ue,w=ge,T=we,R=Ce,H=un,G=he,P=dn,$=be,U=ke,N=cn,V=pn,j=Ve,M=Te,Q=Fe,J=Ee;return u(),h(B,null,[e(G,null,{default:n(()=>[ne(a.$slots,"headerStart",{},void 0,!0),e(R,null,{default:n(()=>[e(f,null,{default:n(()=>[d(_(s.title??"Select"),1)]),_:1}),e(T,{onClick:i[0]||(i[0]=c=>A()),slot:"end",fill:"clear",color:"dark"},{default:n(()=>[e(w,{icon:"ioniconsClose"in a?a.ioniconsClose:o(Me),size:"medium"},null,8,["icon"])]),_:1})]),_:1}),e(R,null,{default:n(()=>[e(H,{debounce:200,onIonInput:i[1]||(i[1]=c=>m(c))})]),_:1}),ne(a.$slots,"headerEnd",{},void 0,!0)]),_:3}),e(M,{color:"light",class:"ion-padding"},{default:n(()=>[ne(a.$slots,"default",{},void 0,!0),s.allowMultiple?(u(),g(U,{key:0,id:"modal-list",inset:!0},{default:n(()=>[(u(!0),h(B,null,K(o(S),c=>(u(),g($,{key:s.getItemValue(c)},{default:n(()=>[e(P,{value:s.getItemValue(c),checked:L(s.getItemValue(c)),onIonChange:i[2]||(i[2]=x=>q(x)),innerHTML:typeof s.renderItem=="function"?s.renderItem(c):s.getItemText(c)},null,8,["value","checked","innerHTML"])]),_:2},1024))),128))]),_:1})):o(S).length>0?(u(),g(U,{key:1,id:"modal-list",inset:!0},{default:n(()=>[e(V,{value:o(b)[0],onIonChange:i[3]||(i[3]=c=>O(c))},{default:n(()=>[(u(!0),h(B,null,K(o(S),c=>(u(),g($,{key:s.getItemValue(c)},{default:n(()=>[e(N,{value:s.getItemValue(c),innerHTML:typeof s.renderItem=="function"?s.renderItem(c):s.getItemText(c)},null,8,["value","innerHTML"])]),_:2},1024))),128))]),_:1},8,["value"])]),_:1})):(u(),g(j,{key:2,color:"medium"},{default:n(()=>[jn]),_:1})),ne(a.$slots,"contentEnd",{},void 0,!0)]),_:3}),e(J,null,{default:n(()=>[e(R,null,{default:n(()=>[ne(a.$slots,"footer",{},void 0,!0),e(Q,{slot:"end"},{default:n(()=>[e(T,{onClick:i[4]||(i[4]=c=>k()),color:"primary"},{default:n(()=>[e(w,{slot:"start",icon:"ioniconsCheckmark"in a?a.ioniconsCheckmark:o(rn)},null,8,["icon"]),d(" Confirm ")]),_:1})]),_:1})]),_:3})]),_:3})],64)}}}),Wn=Se(Kn,[["__scopeId","data-v-697993b6"]]),qn=v=>(Be("data-v-824f3a2b"),v=v(),ze(),v),Gn={slot:"end",class:"file-wrapper"},Qn={key:0,class:"file-box"},Yn=qn(()=>W("p",null,"Drag and drop your file here",-1)),Xn=ye({__name:"firmwareSelectFile",props:fn({fileType:{},productType:{},releaseType:{}},{modelValue:{type:Object},modelModifiers:{}}),emits:["update:modelValue"],setup(v){const D=v,s=mn(v,"modelValue"),{$api:z}=Ge(),{request:S,newMsgId:b}=_n(vn.IPC_FLASH),L=zn(),A=Qe(),k=Pn(),m=p(),I=p(),q=oe(()=>L.value.filter(t=>t.type.id===D.fileType.id&&t.products.some(l=>l.id===D.productType)&&(D.releaseType===2?t.releaseTypes.find(l=>l.id===2):!0))),O=p(null),a=p(null),i=p(!1),f=p(0),w=p(Z.IDLE),T=p(""),R=p(""),H=p(""),G=p(""),P=p(1),$=p([D.productType]),U=p(!1),N=p(!1),V=t=>N.value=t,j=p(!1),M=t=>j.value=t,Q=oe(()=>{switch(w.value){case Z.ERROR:return"danger";case Z.FINISHED:return"success";default:return""}});function J(){O.value&&O.value.click()}function c(t){const y=t.target.files;y&&y.length>0&&(m.value=y[0])}function x(t){if(!t.dataTransfer)return;const l=t.dataTransfer.files;l.length>0&&(m.value=l[0])}function le(t){var l,y;a&&t?(l=a.value)==null||l.classList.add("hover"):(y=a.value)==null||y.classList.remove("hover")}async function de(t,l){const y=He("76b513a2d19d972de051a10596a3afdb"),Y=await crypto.subtle.importKey("raw",He(t),{name:"AES-CTR"},!1,["encrypt","decrypt"]);return crypto.subtle.encrypt({name:"AES-CTR",counter:y,length:128},Y,l)}async function ce(){var t,l,y;if(i.value=!0,f.value=0,w.value=Z.UPLOADING,m.value){const{name:Y}=m.value;try{const{data:C}=await z.createFirmwareFile({createFirmwareFileRequest:{fileTypeId:D.fileType.id,name:Y,releaseTypeIds:P.value===1?[1]:[1,2],productIds:$.value,version:R.value,remarks:H.value.length===0?void 0:H.value,fileHash:T.value}}),F=(t=C.firmwareFile)==null?void 0:t.id,X=(l=C.firmwareFile)==null?void 0:l.upload.url,ae=(y=C.firmwareFile)==null?void 0:y.encryptionKey,_e=await m.value.arrayBuffer(),se=await de(ae,_e);await An(se,m.value.type,X,ee=>{f.value=ee}),w.value=Z.FINISHED,await L.update(),I.value=L.value.find(ee=>ee.id===F),s&&(s.value=I.value),V(!1),M(!1)}catch(C){i.value=!1,f.value=0,w.value=Z.ERROR;const{msg:F}=await Ye(C);G.value=F,console.error(F)}}i.value=!1,f.value=0}const pe=oe(()=>m.value!==void 0&&T.value.length>0&&U.value);In(m,async t=>{if(T.value="",!t)return;const{result:l}=await S({type:yn.UTILITY_REQUEST,id:b(),args:[t.path],fn:gn.CRC32});T.value=l});function fe(t){const l=t.target;if(l===null)return;l.classList.remove("ion-touched"),l.classList.remove("ion-valid"),l.classList.remove("ion-invalid");const y=t.detail.value??"";Xe(y)?(l.classList.add("ion-valid"),U.value=!0):(l.classList.add("ion-invalid"),U.value=!1),l.classList.add("ion-touched")}function me(t){I.value=L.value.find(l=>l.id===t[0]),s&&(s.value=I.value),V(!1)}return(t,l)=>{const y=kn,Y=Vn,C=ge,F=be,X=we,ae=Fe,_e=Wn,se=Tn,ee=ue,Ze=Fn,Le=Ce,Je=he,xe=Ae,en=Sn,nn=Oe,on=je,Re=Ke,$e=We,Ue=qe,tn=ke,ln=Te,an=Ve,sn=Ee;return u(),h(B,null,[e(F,{button:!0,detail:!1,onClick:l[0]||(l[0]=r=>V(!0))},{default:n(()=>{var r;return[e(y,null,{default:n(()=>[d(_(t.fileType.name),1)]),_:1}),W("div",Gn,[(r=o(I))!=null&&r.name?(u(),h("div",Qn,[e(y,null,{default:n(()=>{var E;return[d(_((E=o(I))==null?void 0:E.name),1)]}),_:1}),e(Y,{class:"file-note"},{default:n(()=>{var E,De;return[d(" Version: "+_((E=o(I))==null?void 0:E.version)+" | Hash: "+_((De=o(I))==null?void 0:De.fileHash),1)]}),_:1})])):(u(),g(Y,{key:1},{default:n(()=>[d("no file selected")]),_:1})),e(C,{icon:"ioniconsCaretDownSharp"in t?t.ioniconsCaretDownSharp:o(wn),style:{width:"0.8125rem"},class:Cn(o(N)?"file-caret-up":"file-caret-down")},null,8,["icon","class"])])]}),_:1}),e(se,{"is-open":o(N),onWillDismiss:l[4]||(l[4]=r=>V(!1))},{default:n(()=>[e(_e,{title:"Select File",allowMultiple:!1,items:o(q),selectedItems:o(I)?[o(I).id]:[],getItemValue:r=>r.id,getItemText:r=>r.name,renderItem:r=>`
        <ion-label>${r.name}</ion-label>
        <ion-note class='file-note'>Version: ${r.version}</ion-note>
        <ion-note class='file-note'>Hash: ${r.fileHash}</ion-note>
        <ion-note class='file-note'>Remarks: ${r.remarks??"–"}</ion-note>`,onSelectionChange:l[2]||(l[2]=r=>me(r)),onSelectionCancel:l[3]||(l[3]=r=>V(!1))},{footer:n(()=>[e(ae,{slot:"start"},{default:n(()=>[e(X,{onClick:l[1]||(l[1]=r=>M(!0)),color:"medium",class:"upload-file-button"},{default:n(()=>[e(C,{slot:"start",icon:"ioniconsAdd"in t?t.ioniconsAdd:o(hn)},null,8,["icon"]),d(" Upload New File ")]),_:1})]),_:1})]),_:1},8,["items","selectedItems","getItemValue","getItemText","renderItem"])]),_:1},8,["is-open"]),e(se,{"is-open":o(j),onWillDismiss:l[14]||(l[14]=r=>M(!1))},{default:n(()=>[e(Je,null,{default:n(()=>[e(Le,null,{default:n(()=>[e(ee,null,{default:n(()=>[d("Upload File")]),_:1}),o(i)?(u(),g(Ze,{key:0,value:o(f),color:"warning"},null,8,["value"])):te("",!0),e(X,{onClick:l[5]||(l[5]=r=>M(!1)),slot:"end",fill:"clear",color:"dark"},{default:n(()=>[e(C,{icon:"ioniconsClose"in t?t.ioniconsClose:o(Me),size:"medium"},null,8,["icon"])]),_:1})]),_:1})]),_:1}),e(ln,{class:"ion-padding"},{default:n(()=>[W("div",{ref_key:"uploadContainer",ref:a,class:"upload-container",onDragover:l[6]||(l[6]=ie(()=>{},["prevent"])),onDragenter:l[7]||(l[7]=ie(r=>le(!0),["prevent"])),onDragleave:l[8]||(l[8]=ie(r=>le(!1),["prevent"])),onDrop:ie(x,["prevent"]),onClick:J},[Yn,e(X,{color:"secondary"},{default:n(()=>[d(" Browse File ")]),_:1}),W("input",{type:"file",ref_key:"fileInput",ref:O,onChange:c,style:{display:"none"}},null,544)],544),o(m)?(u(),g(on,{key:0,color:o(Q)},{default:n(()=>[e(nn,null,{default:n(()=>[e(xe,null,{default:n(()=>[d(" Selected file: "+_(o(m).name),1)]),_:1}),e(en,null,{default:n(()=>[d(" Type: "+_(o(m).type)+" | Size: "+_(o(m).size)+" bytes | Hash: "+_(o(T)),1)]),_:1})]),_:1})]),_:1},8,["color"])):te("",!0),o(m)?(u(),g(tn,{key:1},{default:n(()=>[e(F,null,{default:n(()=>[e(C,{"aria-hidden":"true",icon:"ioniconsPricetag"in t?t.ioniconsPricetag:o(Pe),slot:"start"},null,8,["icon"]),e(Re,{label:"Version",class:"ion-text-right input-text-validation-end",modelValue:o(R),"onUpdate:modelValue":l[9]||(l[9]=r=>re(R)?R.value=r:null),placeholder:"e.g. v1.0.0-beta1",onIonInput:fe,"error-text":o(U)?"":"Expected semantic versioning format. e.g. v1.0.0-beta1"},null,8,["modelValue","error-text"])]),_:1}),e(F,null,{default:n(()=>[e(C,{"aria-hidden":"true",icon:"ioniconsDocument"in t?t.ioniconsDocument:o(Ne),slot:"start"},null,8,["icon"]),e(Re,{label:"Description",class:"ion-text-right input-text-validation-end",modelValue:o(H),"onUpdate:modelValue":l[10]||(l[10]=r=>re(H)?H.value=r:null),placeholder:"optional"},null,8,["modelValue"])]),_:1}),e(F,null,{default:n(()=>[e(C,{"aria-hidden":"true",icon:"ioniconsLayers"in t?t.ioniconsLayers:o(ve),slot:"start"},null,8,["icon"]),e(Ue,{modelValue:o(P),"onUpdate:modelValue":l[11]||(l[11]=r=>re(P)?P.value=r:null),class:"select",placeholder:"Select release type",label:"Release"},{default:n(()=>[(u(!0),h(B,null,K(o(A),({id:r,name:E})=>(u(),g($e,{value:r},{default:n(()=>[d(_(("capitalize"in t?t.capitalize:o(Ie))(E)),1)]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"])]),_:1}),e(F,{lines:"none"},{default:n(()=>[e(C,{"aria-hidden":"true",icon:"ioniconsLayers"in t?t.ioniconsLayers:o(ve),slot:"start"},null,8,["icon"]),e(Ue,{modelValue:o($),"onUpdate:modelValue":l[12]||(l[12]=r=>re($)?$.value=r:null),class:"select",placeholder:"Select compatible products",label:"Compatible Products",multiple:""},{default:n(()=>[(u(!0),h(B,null,K(o(k),({id:r,name:E})=>(u(),g($e,{value:r},{default:n(()=>[d(_(("capitalize"in t?t.capitalize:o(Ie))(E)),1)]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"])]),_:1})]),_:1})):te("",!0)]),_:1}),e(sn,null,{default:n(()=>[e(Le,null,{default:n(()=>[e(F,{lines:"none"},{default:n(()=>[e(an,{color:"danger"},{default:n(()=>[d(_(o(G)),1)]),_:1})]),_:1}),e(ae,{slot:"end"},{default:n(()=>[e(X,{onClick:l[13]||(l[13]=r=>ce()),disabled:!o(pe),color:"primary"},{default:n(()=>[e(C,{slot:"start",icon:"ioniconsCloudUpload"in t?t.ioniconsCloudUpload:o(bn)},null,8,["icon"]),d(" Upload ")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["is-open"])],64)}}}),Zn=Se(Xn,[["__scopeId","data-v-824f3a2b"]]),Jn={key:0,class:"firmware-centered"},xn={key:0},eo={key:1},no=ye({__name:"createRelease",setup(v){const{$api:D}=Ge(),s=Ln(),z=p({}),S=oe(()=>Object.values(z.value).map(a=>a.id)),b=Qe(),L=Nn(),A=oe(()=>{const a=L.value.find(i=>i.id===s.value.firmwareId);return a?a.fileTypes:[]}),k=p(null),m=p(null),I=p(!1);function q(){var f;const a=m.value.$el;if(a===null)return;a.classList.remove("ion-touched"),a.classList.remove("ion-valid"),a.classList.remove("ion-invalid");const i=((f=a.value)==null?void 0:f.toString())??"";Xe(i)?(a.classList.add("ion-valid"),I.value=!0):(a.classList.add("ion-invalid"),I.value=!1),a.classList.add("ion-touched")}async function O(){try{const{data:a}=await D.createFirmwareRelease({createFirmwareReleaseRequest:{firmwareId:s.value.firmwareId,releaseTypeId:s.value.releaseId,tag:s.value.releaseVersion,remarks:s.value.releaseDescription,firmwareFileIds:S.value}});k.value={success:!0,id:a.firmwareRelease.id}}catch(a){console.error("Error creating release:",{error:a}),k.value={success:!1,error:(await Ye(a)).msg}}}return Rn(q),(a,i)=>{const f=ge,w=we,T=Fe,R=ue,H=Bn,G=Ce,P=he,$=ue,U=We,N=qe,V=be,j=Ke,M=ke,Q=Un,J=Zn,c=Dn,x=Ae,le=Oe,de=Ve,ce=Hn,pe=je,fe=Te,me=$n;return u(),g(me,null,{default:n(()=>[e(P,null,{default:n(()=>[e(G,null,{default:n(()=>[e(T,{slot:"start"},{default:n(()=>[e(w,{color:"dark","router-link":"/firmware/","router-direction":"back"},{default:n(()=>[e(f,{slot:"icon-only",icon:"ioniconsChevronBack"in a?a.ioniconsChevronBack:o(Mn)},null,8,["icon"])]),_:1})]),_:1}),e(R,null,{default:n(()=>[d("Firmware – Create new Release")]),_:1}),e(T,{slot:"end"},{default:n(()=>[e(H)]),_:1})]),_:1})]),_:1}),e(fe,{fullscreen:!0,class:"ion-padding"},{default:n(()=>[e(c,null,{default:n(()=>[e(Q,null,{default:n(()=>[e($,null,{default:n(()=>[d("Release")]),_:1}),e(M,null,{default:n(()=>[e(V,null,{default:n(()=>[e(f,{"aria-hidden":"true",icon:"ioniconsHardwareChip"in a?a.ioniconsHardwareChip:o(En),slot:"start"},null,8,["icon"]),e(N,{modelValue:o(s).firmwareId,"onUpdate:modelValue":i[0]||(i[0]=t=>o(s).firmwareId=t),class:"select",placeholder:"Select firmware type",label:"Firmware",interface:"popover"},{default:n(()=>[(u(!0),h(B,null,K(o(L),({id:t,name:l})=>(u(),g(U,{value:t},{default:n(()=>[d(_(l),1)]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"])]),_:1}),e(V,null,{default:n(()=>[e(f,{"aria-hidden":"true",icon:"ioniconsLayers"in a?a.ioniconsLayers:o(ve),slot:"start"},null,8,["icon"]),e(N,{modelValue:o(s).releaseId,"onUpdate:modelValue":i[1]||(i[1]=t=>o(s).releaseId=t),class:"select",placeholder:"Select release type",label:"Release Type",interface:"popover"},{default:n(()=>[(u(!0),h(B,null,K(o(b),({id:t,name:l})=>(u(),g(U,{value:t},{default:n(()=>[d(_(("capitalize"in a?a.capitalize:o(Ie))(l)),1)]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"])]),_:1}),e(V,null,{default:n(()=>[e(f,{"aria-hidden":"true",icon:"ioniconsPricetag"in a?a.ioniconsPricetag:o(Pe),slot:"start"},null,8,["icon"]),e(j,{ref_key:"versionInputRef",ref:m,label:"Version",class:"ion-text-right",modelValue:o(s).releaseVersion,"onUpdate:modelValue":i[2]||(i[2]=t=>o(s).releaseVersion=t),placeholder:"e.g. v1.0.0-beta1",onIonInput:q,"error-text":o(I)?"":"Expected semantic versioning format. e.g. v1.0.0-beta1"},null,8,["modelValue","error-text"])]),_:1}),e(V,null,{default:n(()=>[e(f,{"aria-hidden":"true",icon:"ioniconsDocument"in a?a.ioniconsDocument:o(Ne),slot:"start"},null,8,["icon"]),e(j,{label:"Description",class:"ion-text-right",modelValue:o(s).releaseDescription,"onUpdate:modelValue":i[3]||(i[3]=t=>o(s).releaseDescription=t),placeholder:"Used for development"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(Q,null,{default:n(()=>[e($,null,{default:n(()=>[d("Files")]),_:1}),e(M,null,{default:n(()=>[(u(!0),h(B,null,K(o(A),t=>(u(),g(J,{modelValue:o(z)[t.id],"onUpdate:modelValue":l=>o(z)[t.id]=l,fileType:t,productType:o(L).find(l=>l.id===o(s).firmwareId).product.id,releaseType:o(s).releaseId,key:`${t.id}${o(s).firmwareId}`},null,8,["modelValue","onUpdate:modelValue","fileType","productType","releaseType"]))),128))]),_:1}),o(A).length===0?(u(),h("div",Jn," Select a firmware type ")):te("",!0)]),_:1})]),_:1}),e(c,{class:"ion-justify-content-end"},{default:n(()=>[e(w,{color:"medium","router-link":"/firmware/","router-direction":"back"},{default:n(()=>[d(" Cancel ")]),_:1}),e(w,{onClick:i[4]||(i[4]=t=>O()),disabled:o(S).length!==o(A).length||!o(I)},{default:n(()=>[d(" Create Release ")]),_:1},8,["disabled"])]),_:1}),o(k)?(u(),g(c,{key:0,class:"ion-justify-content-center"},{default:n(()=>[e(pe,{color:o(k).success?"success":"danger"},{default:n(()=>[e(le,null,{default:n(()=>[e(x,null,{default:n(()=>[d(_(o(k).success?"Release Created":"Error"),1)]),_:1})]),_:1}),e(ce,null,{default:n(()=>[e(de,null,{default:n(()=>[o(k).success?(u(),h("p",xn,[d(" Release "),W("strong",null,_(o(s).releaseVersion),1),d(" was successfully created with ID "),W("strong",null,_(o(k).id),1),d(". ")])):(u(),h("p",eo,_(o(k).error),1))]),_:1})]),_:1})]),_:1},8,["color"])]),_:1})):te("",!0)]),_:1})]),_:1})}}}),io=Se(no,[["__scopeId","data-v-d136e14a"]]);export{io as default};
