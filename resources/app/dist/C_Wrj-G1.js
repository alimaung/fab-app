import{d as ue,u as ie,r as h,K as re,ao as de,t as v,L as C,A as e,z as t,B as n,N as o,P as ce,ai as D,O as w,ay as _e,y as d,bH as fe,bI as pe,v as z,R as S,Q as M,m as me,dy as ve,a0 as ye,a5 as ge,a6 as ke,a3 as Ce,$ as we,ab as Ie,ap as xe,a4 as be,a2 as he,X as Te,aj as De,as as ze,aq as Se,aa as $e,bQ as Ne,a8 as Re,a9 as Le,C as Pe,D as qe,x as F,_ as Be}from"./0fV2q4Ox.js";import{_ as Ve}from"./CxwSbNEQ.js";import{_ as Me,a as Qe}from"./CEjZCPuH.js";import{g as Fe,h as Ue}from"./M_3S_cE4.js";import{g as Ee,w as He}from"./D0r5xylr.js";import{i as $}from"./BThVWU2R.js";import{t as Q}from"./DRWRzBEg.js";import{u as Ae}from"./rGigr8ii.js";const U=x=>(Pe("data-v-2c33eadc"),x=x(),qe(),x),Ge=U(()=>F("span",null,"Tags",-1)),Ke=U(()=>F("span",null,"Debug Modes",-1)),Oe=ue({__name:"queryDevice",setup(x){const{$api:I}=me(),E=ie(),y=h(""),k=h(null),a=h(null),b=h(!1),{historyUp:H,historyDown:A,historyAdd:G}=Ae(y,"queryDeviceInput"),K=Fe(),N=Ue();re(()=>E.currentRoute.value.query.productSerial,u=>{y.value=(u==null?void 0:u.toString())??"",T()},{immediate:!0});async function T(){var u,i,p;if(y.value.length===0){R();return}b.value=!0,G(y.value);try{const{data:c}=await I.deviceList({deviceListRequest:Ee(y.value)});if(a.value=c.devices[0],!a.value)throw new Error("Device not found");(u=k.value)==null||u.$el.classList.add("ion-valid")}catch{(i=k.value)==null||i.$el.classList.add("ion-invalid"),a.value=null}finally{(p=k.value)==null||p.$el.classList.add("ion-touched"),b.value=!1}await L()}async function R(){y.value="",a.value=null,P(),await L()}async function L(){await He(300),de(()=>{var u;return(u=k==null?void 0:k.value)==null?void 0:u.$el.setFocus()})}function P(){var u;(u=k.value)==null||u.$el.classList.remove("ion-touched","ion-valid","ion-invalid")}async function O(u){if(a.value===null)return;const{productSerial:i}=a.value,c=a.value.tags.some(_=>_.id===u.id)?a.value.tags.filter(_=>_.id!==u.id):a.value.tags.concat(u),g=c.map(_=>_.id);try{await I.modifyDevice({modifyDeviceRequest:{productSerial:i,tagIds:g}}),a.value.tags=c}catch(_){await $(_)}}async function j(u,i){if(a.value===null||a.value.debugModes===void 0||u===void 0)return;const{productSerial:p}=a.value,c=i?a.value.debugModes.concat(u):a.value.debugModes.filter(_=>_.id!==u.id),g=c.map(_=>_.id);try{await I.modifyDevice({modifyDeviceRequest:{productSerial:p,debugModeIds:g}}),a.value.debugModes=c}catch(_){await $(_)}}async function W(){await(await ve.create({header:"Create new tag",inputs:[{name:"tagName",type:"text",placeholder:"Name"},{name:"tagDescription",type:"text",placeholder:"Description"}],buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary"},{text:"Create",handler:async i=>{const{tagName:p,tagDescription:c}=i;try{if(p.length<3)throw new Error("Tag name must be at least 3 characters");if(c.length<10)throw new Error("Tag description must be at least 10 characters");await I.createTag({createTagRequest:{name:p,description:c}});const{data:g}=await I.getTagList();N.value=g.tags}catch(g){await $(g)}}}]})).present()}function X(u){var p;const i=(p=a.value)==null?void 0:p.product.type.id;return u.productTypes.some(c=>c.id===i)}return(u,i)=>{const p=ye,c=ge,g=ke,_=Ce,Y=we,J=Ie,Z=xe,ee=be,q=he,te=Te,r=De,l=ze,f=Ve,B=Me,ae=Qe,V=Se,ne=$e,le=Ne,oe=Re,se=Le;return v(),C(se,null,{default:e(()=>[t(g,null,{default:e(()=>[t(p,null,{default:e(()=>[n("Device Query")]),_:1}),t(c,null,{default:e(()=>[n(" Query using a productSerial, dataMatrixCode or Wi-Fi QR-Code ")]),_:1})]),_:1}),t(oe,null,{default:e(()=>[t(q,{lines:"none"},{default:e(()=>[t(_,{ref_key:"inputRef",ref:k,type:"text",label:"Identifier","error-text":"No device found",modelValue:o(y),"onUpdate:modelValue":i[0]||(i[0]=s=>ce(y)?y.value=s:null),autofocus:"",onIonInput:i[1]||(i[1]=s=>P()),onKeyup:[i[2]||(i[2]=D(s=>T(),["enter"])),i[3]||(i[3]=D(s=>o(H)(),["up"])),i[4]||(i[4]=D(s=>o(A)(),["down"]))]},null,8,["modelValue"]),o(b)?(v(),C(Y,{key:0,slot:"end",size:"small",color:"primary",name:"crescent"})):w("",!0),t(J,{slot:"end",label:"Clear input",icon:"ioniconsBackspace"in u?u.ioniconsBackspace:o(_e),onClick:i[5]||(i[5]=s=>R())},null,8,["icon"]),t(ee,{class:"ion-margin-start",slot:"end",color:"primary",onClick:i[6]||(i[6]=s=>T()),disabled:o(b)},{default:e(()=>[t(Z,null,{default:e(()=>[n("Query")]),_:1})]),_:1},8,["disabled"])]),_:1}),o(a)?(v(),C(r,{key:0,class:"ion-margin-top"},{default:e(()=>[t(te,{class:"ion-no-padding"},{default:e(()=>[n("Results")]),_:1})]),_:1})):w("",!0),o(a)?(v(),C(le,{key:1},{default:e(()=>[t(r,null,{default:e(()=>[t(l,{size:"4"},{default:e(()=>[n("Product Name")]),_:1}),t(l,{class:"text-dark"},{default:e(()=>[t(f,null,{default:e(()=>[n(d(o(a).product.name),1)]),_:1})]),_:1})]),_:1}),t(r,null,{default:e(()=>[t(l,{size:"4"},{default:e(()=>[n("Product Type")]),_:1}),t(l,{class:"ion-text-capitalize text-dark"},{default:e(()=>[t(f,null,{default:e(()=>[n(d(o(a).product.type.name),1)]),_:1})]),_:1})]),_:1}),t(r,null,{default:e(()=>[t(l,{size:"4"},{default:e(()=>[n("Product Model")]),_:1}),t(l,{class:"text-dark"},{default:e(()=>[t(f,null,{default:e(()=>[n(d(o(a).product.model),1)]),_:1})]),_:1})]),_:1}),t(r,null,{default:e(()=>[t(l,{size:"4"},{default:e(()=>[n("Product Version")]),_:1}),t(l,{class:"text-dark"},{default:e(()=>[t(f,null,{default:e(()=>[n(d(o(a).product.variant.version),1)]),_:1})]),_:1})]),_:1}),t(r,null,{default:e(()=>[t(l,{size:"4"},{default:e(()=>[n("Product Variant Remarks")]),_:1}),t(l,{class:"text-dark"},{default:e(()=>[t(f,null,{default:e(()=>[n(d(o(a).product.variant.remarks),1)]),_:1})]),_:1})]),_:1}),t(r,null,{default:e(()=>[t(l,{size:"4"},{default:e(()=>[n("Product Serial")]),_:1}),t(l,{class:"text-dark"},{default:e(()=>[t(ae,{label:o(a).productSerial},{default:e(()=>[t(B,{label:"Copy",icon:"ioniconsCopy"in u?u.ioniconsCopy:o(fe),action:"copy"},null,8,["icon"]),["gateway","inverter"].includes(o(a).product.type.name)?(v(),C(B,{key:0,label:`Debug ${o(Q)(o(a).product.type.name)}`,icon:"ioniconsSearch"in u?u.ioniconsSearch:o(pe),action:`debug${o(Q)(o(a).product.type.name)}`,default:""},null,8,["label","icon","action"])):w("",!0)]),_:1},8,["label"])]),_:1})]),_:1}),t(r,null,{default:e(()=>[t(l,{size:"4"},{default:e(()=>[n("Product Serial ID")]),_:1}),t(l,{class:"text-dark"},{default:e(()=>[t(f,null,{default:e(()=>[n(d(o(a).productSerialId),1)]),_:1})]),_:1})]),_:1}),t(r,null,{default:e(()=>[t(l,{size:"4"},{default:e(()=>[n("Product Code")]),_:1}),t(l,{class:"text-dark"},{default:e(()=>[t(f,null,{default:e(()=>[n(d(o(a).product.productCode),1)]),_:1})]),_:1})]),_:1}),t(r,null,{default:e(()=>[t(l,{size:"4"},{default:e(()=>[n("Serial Number")]),_:1}),t(l,{class:"text-dark"},{default:e(()=>[t(f,null,{default:e(()=>[n(d(o(a).serialNumber),1)]),_:1})]),_:1})]),_:1}),t(r,null,{default:e(()=>[t(l,{size:"4"},{default:e(()=>[n("Data Matrix Code")]),_:1}),t(l,{class:"text-dark"},{default:e(()=>[t(f,null,{default:e(()=>[n(d(o(a).dataMatrixCode),1)]),_:1})]),_:1})]),_:1}),t(r,null,{default:e(()=>[t(l,{size:"4"},{default:e(()=>[n("Device Hash")]),_:1}),t(l,{class:"text-dark"},{default:e(()=>[t(f,null,{default:e(()=>[n(d(o(a).deviceHash),1)]),_:1})]),_:1})]),_:1}),t(r,null,{default:e(()=>[t(l,{size:"4"},{default:e(()=>[n("Firmware Name")]),_:1}),t(l,{class:"text-dark"},{default:e(()=>[t(f,null,{default:e(()=>{var s;return[n(d((s=o(a).firmware)==null?void 0:s.name),1)]}),_:1})]),_:1})]),_:1}),t(r,null,{default:e(()=>[t(l,{size:"4"},{default:e(()=>[n("Firmware Release Tag")]),_:1}),t(l,{class:"text-dark"},{default:e(()=>[t(f,null,{default:e(()=>{var s,m;return[n(d((m=(s=o(a).firmware)==null?void 0:s.release)==null?void 0:m.tag),1)]}),_:1})]),_:1})]),_:1}),t(r,null,{default:e(()=>[t(l,{size:"4"},{default:e(()=>[n("Firmware Deployment Group")]),_:1}),t(l,{class:"text-dark"},{default:e(()=>[t(f,null,{default:e(()=>{var s,m;return[n(d((m=(s=o(a).firmware)==null?void 0:s.deploymentGroup)==null?void 0:m.name),1)]}),_:1})]),_:1})]),_:1}),t(r,null,{default:e(()=>[t(l,{size:"4"},{default:e(()=>[n("Remarks")]),_:1}),t(l,{class:"text-dark"},{default:e(()=>[t(f,null,{default:e(()=>[n(d(o(a).remarks),1)]),_:1})]),_:1})]),_:1}),t(r,null,{default:e(()=>[t(l,{size:"4"},{default:e(()=>[n("Created")]),_:1}),t(l,{class:"text-dark"},{default:e(()=>{var s;return[n(d((s=o(a).creationTimeStamp)==null?void 0:s.toUTCString()),1)]}),_:1})]),_:1}),t(r,null,{default:e(()=>[t(l,{size:"4"},{default:e(()=>[n("Status")]),_:1}),t(l,{class:"text-dark"},{default:e(()=>[n(d(o(a).status.name),1)]),_:1})]),_:1}),t(r,null,{default:e(()=>[t(l,{size:"4"},{default:e(()=>[n("Provisioned")]),_:1}),t(l,{class:"text-dark"},{default:e(()=>[n(d(o(a).status.isProvisioned?"Yes":"No"),1)]),_:1})]),_:1}),t(r,null,{default:e(()=>[t(l,{size:"4"},{default:e(()=>[n("Last Contact")]),_:1}),t(l,{class:"text-dark"},{default:e(()=>{var s;return[n(d((s=o(a).status.contactTimeStamp)==null?void 0:s.toUTCString()),1)]}),_:1})]),_:1}),t(r,null,{default:e(()=>[t(l,{class:"vertical-center",size:"4"},{default:e(()=>[Ge]),_:1}),t(l,{class:"flex-wrap"},{default:e(()=>[(v(!0),z(S,null,M(o(N),s=>(v(),C(V,{title:`${s.description} (${s.id})`,color:o(a).tags.some(m=>m.id===s.id)?"tertiary":"medium",onClick:m=>O(s)},{default:e(()=>[n(d(s.name.toUpperCase()),1)]),_:2},1032,["title","color","onClick"]))),256)),t(V,{color:"success",title:"Add tag",onClick:i[7]||(i[7]=s=>W())},{default:e(()=>[n(" + ")]),_:1})]),_:1})]),_:1}),o(a).debugModes?(v(),C(r,{key:0},{default:e(()=>[t(l,{class:"vertical-center",size:"4"},{default:e(()=>[Ke]),_:1}),t(l,null,{default:e(()=>[(v(!0),z(S,null,M(o(K),s=>(v(),z(S,null,[X(s)?(v(),C(q,{key:0,title:`${s.description} (${s.id})`,lines:"none",class:"debug-modes"},{default:e(()=>[t(ne,{"label-placement":"start",title:s.description,checked:o(a).debugModes.some(m=>m.id===s.id),onIonChange:m=>j(s,m.detail.checked)},{default:e(()=>[n(d(s.name.toUpperCase()),1)]),_:2},1032,["title","checked","onIonChange"])]),_:2},1032,["title"])):w("",!0)],64))),256))]),_:1})]),_:1})):w("",!0)]),_:1})):w("",!0)]),_:1})]),_:1})}}}),at=Be(Oe,[["__scopeId","data-v-2c33eadc"]]);export{at as default};
