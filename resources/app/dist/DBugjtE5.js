import{d as He,u as Me,r,o as qe,al as Fe,L as v,A as o,m as Qe,M as ze,t as u,z as t,N as l,B as i,y as _,x as s,O as b,P as A,ai as k,am as Ee,an as Ke,v as S,Q as O,R,ao as Oe,ab as Re,a4 as We,W as Xe,X as J,Y as ee,Z as te,a0 as Ye,a8 as Ze,a9 as je,a6 as Je,ap as et,a5 as tt,af as ot,a1 as nt,a3 as lt,aa as at,aq as st,ar as it,as as rt,$ as ut,a2 as dt,b4 as ct,b5 as pt,ac as _t,aw as mt,ax as oe,ay as vt,C as ft,D as yt,_ as It}from"./0fV2q4Ox.js";import{_ as gt}from"./logout.js";import{b as bt}from"./M_3S_cE4.js";import{u as ne}from"./rGigr8ii.js";import"./BYx_WZxC.js";const W=L=>(ft("data-v-48565beb"),L=L(),yt(),L),Ct={style:{width:"100%"}},ht={style:{display:"flex","flex-direction":"row",width:"100%"}},kt={class:"ion-padding"},St=W(()=>s("p",{class:"ion-text-center"},"No other tags available",-1)),Dt={key:0,class:"device-table"},$t=W(()=>s("tr",null,[s("th",null,"Index"),s("th",null,"Product Serial"),s("th",null,"Product Serial ID"),s("th",null,"Product Code"),s("th",null,"Serial Number"),s("th",null,"Device Hash")],-1)),wt={key:1,class:"ion-padding"},Nt=W(()=>s("p",{class:"ion-text-center"}," No devices assigned to deployment group ",-1)),Tt=He({__name:"listDeploymentGroupDevices",setup(L){const{$api:G}=Qe(),le=Me(),D=Number(le.currentRoute.value.query.id),ae=bt(),C=r("ProductSerial"),I=r(""),{historyUp:se,historyDown:ie,historyAdd:re}=ne(I,"queryInvertersInput"),h=r(""),{historyUp:ue,historyDown:de,historyAdd:ce}=ne(h,"queryInvertersInput2"),d=r(),V=new Date().toISOString().slice(0,-5),pe=r(V),_e=r(V),g=r(null),P=r(!1),X=r(!1),H=r(),M=r([]),$=r(!1),f=r([]),me=r(100),B=r(null);function Y(a){return ae.value.find(e=>e.id===a)}async function w(a=g.value===null){const e=a?ve:fe,c=I.value.split(" ").filter(p=>p!=="");return re(I.value),ce(h.value),e({identifierType:c.length>0?C.value:void 0,identifierValues:c.length>0?c:void 0,productCode:C.value==="SerialNumber"?Number(h.value):void 0,tagIds:$.value?f.value.map(p=>p.id):void 0,firmwareDeploymentGroupIds:[D],meta:{pagination:{limit:me.value,cursorValue:a?void 0:B.value??void 0}}})}async function ve(a){var e,c,p,m;P.value=!0;try{const{data:U,meta:N}=await G.deviceIdentifierList({deviceIdentifierListRequest:a});g.value=U.devices,B.value=((e=N==null?void 0:N.pagination)==null?void 0:e.cursorNext)??null,(c=d==null?void 0:d.value)==null||c.$el.classList.add("ion-valid")}catch{(p=d==null?void 0:d.value)==null||p.$el.classList.add("ion-invalid"),g.value=null}finally{(m=d==null?void 0:d.value)==null||m.$el.classList.add("ion-touched"),P.value=!1}}async function fe(a){var e,c;try{const{data:p,meta:m}=await G.deviceIdentifierList({deviceIdentifierListRequest:a});(e=g.value)==null||e.push(...p.devices),B.value=((c=m==null?void 0:m.pagination)==null?void 0:c.cursorNext)??null}catch(p){console.error("Can't load more inverters.",p)}}async function ye(a){await w(),setTimeout(()=>a.target.complete(),500)}function Ie(){I.value="",pe.value=V,_e.value=V,Oe(()=>{var a;return(a=d==null?void 0:d.value)==null?void 0:a.$el.setFocus()})}function q(){d.value.$el.classList.remove("ion-touched","ion-valid","ion-invalid"),X.value=!1}function ge(a){f.value.push(a),setTimeout(()=>H.value.$el.dismiss(),200)}function be(a){f.value=f.value.filter(e=>e.id!==a.id)}return qe(async()=>{M.value=(await G.getTagList()).data.tags,w(!0)}),(a,e)=>{const c=Re,p=We,m=Xe,U=J,N=gt,Ce=ee,he=te,F=Ye,Q=Ze,z=je,Z=Je,T=et,ke=tt,x=ot,Se=nt,j=lt,De=at,E=st,$e=J,we=ee,Ne=te,Te=it,xe=rt,Le=ut,Ve=dt,Pe=ct,Be=pt,Ue=_t,Ae=ze,Ge=Fe("tooltip");return u(),v(Ae,null,{default:o(()=>[t(he,null,{default:o(()=>[t(Ce,null,{default:o(()=>[t(m,{slot:"start"},{default:o(()=>[t(p,{color:"dark","router-link":"/firmware/","router-direction":"back"},{default:o(()=>[t(c,{slot:"icon-only",icon:"ioniconsChevronBack"in a?a.ioniconsChevronBack:l(mt)},null,8,["icon"])]),_:1})]),_:1}),t(U,null,{default:o(()=>[i("Firmware â€“ List Deployment Group Devices")]),_:1}),t(m,{slot:"end"},{default:o(()=>[t(N)]),_:1})]),_:1})]),_:1}),t(Ue,{fullscreen:!0,class:"ion-padding"},{default:o(()=>[t(z,{color:"medium"},{default:o(()=>[t(Q,null,{default:o(()=>[t(F,null,{default:o(()=>{var y;return[i(" Selected deployment group: "+_((y=Y(l(D)))==null?void 0:y.name)+" (ID: "+_(l(D))+") ",1)]}),_:1})]),_:1})]),_:1}),l(X)?(u(),v(z,{key:0,color:"success"},{default:o(()=>[t(Z,null,{default:o(()=>[t(F,null,{default:o(()=>[i(" Devices Assigned ")]),_:1})]),_:1}),t(Q,null,{default:o(()=>[t(T,null,{default:o(()=>{var y;return[s("p",null,[i(" Devices were successfully assigned to deployment group "),s("b",null,_((y=Y(l(D)))==null?void 0:y.name)+" (ID: "+_(l(D))+")",1)])]}),_:1})]),_:1})]),_:1})):b("",!0),t(z,{class:"device-card"},{default:o(()=>[t(Z,null,{default:o(()=>[t(F,null,{default:o(()=>[i("Filter Devices")]),_:1}),t(ke,null,{default:o(()=>[i(" Filter the list of devices ")]),_:1})]),_:1}),t(Q,null,{default:o(()=>{var y;return[t(Ve,{lines:"none"},{default:o(()=>[t(Se,{slot:"start",label:"Filter Parameter","label-placement":"floating",placeholder:"Select a filter",modelValue:l(C),"onUpdate:modelValue":e[0]||(e[0]=n=>A(C)?C.value=n:null),style:{"min-width":"19ch","flex-grow":"0"},onIonChange:e[1]||(e[1]=n=>q())},{default:o(()=>[t(x,{value:"ProductSerial"},{default:o(()=>[i(" Product Serial ")]),_:1}),t(x,{value:"ProductSerialId"},{default:o(()=>[i(" Product Serial ID ")]),_:1}),t(x,{value:"DataMatrixCode"},{default:o(()=>[i(" Data Matrix Code ")]),_:1}),t(x,{value:"DeviceHash"},{default:o(()=>[i(" Device Hash ")]),_:1}),t(x,{value:"SerialNumber"},{default:o(()=>[i(" Serial Number ")]),_:1})]),_:1},8,["modelValue"]),s("div",Ct,[s("div",ht,[t(j,{ref_key:"inputRef",ref:d,type:"text","error-text":"No assignable devices found",placeholder:"Enter one or more parameters to filter by (separated by a space)",modelValue:l(I),"onUpdate:modelValue":e[2]||(e[2]=n=>A(I)?I.value=n:null),autofocus:"",onIonInput:e[3]||(e[3]=n=>q()),onKeyup:[e[4]||(e[4]=k(n=>w(!0),["enter"])),e[5]||(e[5]=k(n=>l(se)(),["up"])),e[6]||(e[6]=k(n=>l(ie)(),["down"]))]},null,8,["modelValue"]),l(C)==="SerialNumber"?(u(),v(j,{key:0,type:"text",class:"ion-margin-start","error-text":" ",placeholder:"Product Code",modelValue:l(h),"onUpdate:modelValue":e[7]||(e[7]=n=>A(h)?h.value=n:null),onIonInput:e[8]||(e[8]=n=>q()),onKeyup:[e[9]||(e[9]=k(n=>w(!0),["enter"])),e[10]||(e[10]=k(n=>l(ue)(),["up"])),e[11]||(e[11]=k(n=>l(de)(),["down"]))]},null,8,["modelValue"])):b("",!0)]),s("div",null,[Ee(t(De,{"aria-label":"Restrict using tags",modelValue:l($),"onUpdate:modelValue":e[12]||(e[12]=n=>A($)?$.value=n:null),style:{display:"inline-block",width:"unset"}},null,8,["modelValue"]),[[Ge,"Restrict using tags"]]),s("span",{style:Ke(`opacity: ${l($)?1:.5};`)},[t(xe,{class:"flex-wrap"},{default:o(()=>[l(f).length===0?(u(),v(T,{key:0,color:"medium"},{default:o(()=>[i(" No tags chosen ")]),_:1})):b("",!0),(u(!0),S(R,null,O(l(f),n=>(u(),v(E,{title:`${n.description} (${n.id})`,color:"medium"},{default:o(()=>[i(_(n.name.toUpperCase())+" ",1),t(c,{icon:"ioniconsClose"in a?a.ioniconsClose:l(oe),onClick:K=>be(n)},null,8,["icon","onClick"])]),_:2},1032,["title"]))),256)),t(E,{color:"primary",title:"Add tag",id:"result-tag-button"},{default:o(()=>[i(" + ")]),_:1}),t(Te,{trigger:"result-tag-button",class:"result-filter-modal",ref_key:"resultTagsModal",ref:H},{default:o(()=>[t(Ne,null,{default:o(()=>[t(we,null,{default:o(()=>[t($e,null,{default:o(()=>[i("Choose a tag")]),_:1}),t(p,{onClick:e[13]||(e[13]=n=>l(H).$el.dismiss()),slot:"end",fill:"clear",color:"dark"},{default:o(()=>[t(c,{icon:"ioniconsClose"in a?a.ioniconsClose:l(oe),size:"medium"},null,8,["icon"])]),_:1})]),_:1})]),_:1}),s("div",kt,[(u(!0),S(R,null,O(l(M).filter(n=>!l(f).includes(n)),n=>(u(),v(E,{title:`${n.description} (${n.id})`,color:"medium",onClick:K=>ge(n)},{default:o(()=>[i(" + "+_(n.name.toUpperCase()),1)]),_:2},1032,["title","onClick"]))),256)),l(f).length===l(M).length?(u(),v(T,{key:0,color:"medium"},{default:o(()=>[St]),_:1})):b("",!0)])]),_:1},512)]),_:1})],4)])]),l(P)?(u(),v(Le,{key:0,slot:"end",size:"small",color:"primary",name:"crescent"})):b("",!0),t(c,{slot:"end",label:"Clear input",icon:"ioniconsBackspace"in a?a.ioniconsBackspace:l(vt),onClick:e[14]||(e[14]=n=>Ie())},null,8,["icon"]),t(p,{class:"ion-margin-start",slot:"end",color:"primary",onClick:e[15]||(e[15]=n=>w(!0)),disabled:l(P)},{default:o(()=>[t(T,null,{default:o(()=>[i("Query")]),_:1})]),_:1},8,["disabled"])]),_:1}),((y=l(g))==null?void 0:y.length)>0?(u(),S("table",Dt,[$t,(u(!0),S(R,null,O(l(g),(n,K)=>(u(),S("tr",{key:n.productSerial},[s("td",null,_(K+1),1),s("td",null,_(n.productSerial),1),s("td",null,_(n.productSerialId),1),s("td",null,_(n.productCode),1),s("td",null,_(n.serialNumber),1),s("td",null,_(n.deviceHash),1)]))),128))])):l(g)?(u(),S("div",wt,[t(T,{color:"medium"},{default:o(()=>[Nt]),_:1})])):b("",!0),l(B)?(u(),v(Be,{key:2,onIonInfinite:ye},{default:o(()=>[t(Pe)]),_:1})):b("",!0)]}),_:1})]),_:1})]),_:1})]),_:1})}}}),Ut=It(Tt,[["__scopeId","data-v-48565beb"]]);export{Ut as default};
