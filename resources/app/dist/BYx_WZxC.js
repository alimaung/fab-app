import{c4 as r,e9 as O,cF as w,ea as d,eb as m,ci as s,ck as u,cl as c,cB as h,bZ as S,c5 as T,c1 as C,ec as y,ed as k,ee as v,c7 as I,cc as U,ef as P,eg as b}from"./0fV2q4Ox.js";function g(){return r.Auth.clearCredentials()}const R=(t,n)=>O({category:w.Auth,action:t,...n});function E(t){const n=(t==null?void 0:t.find(_))??(t==null?void 0:t.find(W)),o=(t==null?void 0:t.find(F))??(t==null?void 0:t.find(D));if(n)return n;throw o?d:m}const _=t=>t.startsWith(String(window.location.origin+window.location.pathname)),W=t=>t.includes(String(window.location.hostname)),D=t=>t.startsWith("http://"),F=t=>t.startsWith("https://"),H=async t=>{window!=null&&window.location&&(window.location.href=t.replace("http://","https://"))},L=async t=>{await t.clearOAuthData(),s.clearTokens(),await g(),u.dispatch("auth",{event:"signedOut"},"Auth",c)},$=async(t,n=!1)=>{h(t);const{loginWith:o,userPoolClientId:a}=t,{domain:e,redirectSignOut:i}=o.oauth,l=E(i),f=`https://${e}/logout?${Object.entries({client_id:a,logout_uri:encodeURIComponent(l)}).map(([A,p])=>`${A}=${p}`).join("&")}`;return H(f)},j=async(t,n)=>{const{isOAuthSignIn:o}=await n.loadOAuthSignIn();if(await L(n),o)return $(t)},x=new S("Auth");async function V(t){var a;const n=(a=r.getConfig().Auth)==null?void 0:a.Cognito;T(n),await N(n);let o;try{h(n),o=!0}catch{o=!1}if(o){const e=new P(b);e.setAuthConfig(n);const{type:i}=await j(n,e)??{};if(i==="error")throw new C({name:y,message:"An error occurred when attempting to log out from OAuth provider."})}else s.clearTokens(),await g(),u.dispatch("auth",{event:"signedOut"},"Auth",c)}async function N(t){try{const n=await s.getTokenStore().loadTokens();k(n),B(n.accessToken)&&await v({region:I(t.userPoolId),userAgentValue:R(U.SignOut)},{ClientId:t.userPoolClientId,Token:n.refreshToken})}catch{x.debug("Client signOut error caught but will proceed with token removal")}}const B=t=>{var n;return!!((n=t==null?void 0:t.payload)!=null&&n.origin_jti)};export{E as a,R as g,H as o,V as s};
