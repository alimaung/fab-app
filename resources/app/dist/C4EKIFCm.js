import{d as ze,u as He,r as d,o as Fe,al as Ue,L as c,A as o,m as Re,M as Ee,t as s,z as e,N as t,B as a,y as r,x as f,O as _,P as A,ai as ce,am as Oe,an as qe,v as G,Q as ee,R as oe,ao as xe,ab as Ke,a4 as Qe,W as je,X as me,Y as pe,Z as _e,a0 as We,a8 as Xe,a9 as Ye,a6 as Ze,ap as Je,a5 as eo,af as oo,a1 as no,a3 as to,aa as lo,aq as ao,ar as io,as as so,aj as uo,$ as ro,a2 as co,at as mo,au as po,av as _o,ac as fo,aw as vo,ax as ne,ay as go,az as S,aA as yo,C as bo,D as Io,_ as Co}from"./0fV2q4Ox.js";import{_ as ko}from"./logout.js";import{_ as ho}from"./CxwSbNEQ.js";import{b as So}from"./M_3S_cE4.js";import{a as Do}from"./D0r5xylr.js";import"./BYx_WZxC.js";const K=B=>(bo("data-v-2ea7ee6a"),B=B(),Io(),B),$o={style:{width:"100%"}},wo={style:{display:"flex","flex-direction":"row",width:"100%"}},Po={class:"ion-padding"},To=K(()=>f("p",{class:"ion-text-center"},"No other tags available",-1)),Vo=K(()=>f("span",null,"Restrict to",-1)),No={class:"ion-padding"},Lo=K(()=>f("span",null,"results",-1)),Mo={key:0,class:"ion-margin-top"},Ao={key:2,class:"ion-padding"},Go=K(()=>f("p",{class:"ion-text-center"},"No assignable devices found",-1)),Bo=ze({__name:"assignDeploymentGroup",setup(B){const{$api:te}=Re(),fe=He(),b=Number(fe.currentRoute.value.query.id),ve=So(),h=d("ProductSerial"),D=d(""),z=d(""),m=d(),H=new Date().toISOString().slice(0,-5),ge=d(H),ye=d(H),g=d(null),F=d(null),U=d(!1),R=d(!1),Q=d(),le=d(),j=d([]),$=d(!1),C=d([]),w=d(10);function P(i){return ve.value.find(l=>l.id===i)}async function E(i="PREPARE"){const l=D.value.split(" ").filter(u=>u!=="");return be({identifierType:l.length>0?h.value:void 0,identifierValues:l.length>0?l:void 0,productCode:h.value==="SerialNumber"?Number(z.value):void 0,tagIds:$.value?C.value.map(u=>u.id):void 0,limit:w.value??10},i)}async function be(i,l){var u,y,T;U.value=!0;try{const{data:V}=await te.assignFirmwareDeploymentGroup({assignFirmwareDeploymentGroupRequest:{assign:{firmwareDeploymentGroupId:b},select:i,action:l,integrityValue:l==="COMMIT"?F.value:void 0}});g.value=V.devices,F.value=V.integrityValue,console.log("⚠️ Affected devices:",g.value),(u=m==null?void 0:m.value)==null||u.$el.classList.add("ion-valid")}catch{(y=m==null?void 0:m.value)==null||y.$el.classList.add("ion-invalid"),g.value=null}finally{(T=m==null?void 0:m.value)==null||T.$el.classList.add("ion-touched"),U.value=!1}}async function Ie(){await E("COMMIT"),ae(),R.value=!0}function ae(){D.value="",ge.value=H,ye.value=H,xe(()=>{var i;return(i=m==null?void 0:m.value)==null?void 0:i.$el.setFocus()})}function W(){m.value.$el.classList.remove("ion-touched","ion-valid","ion-invalid"),R.value=!1}function Ce(i){C.value.push(i),setTimeout(()=>Q.value.$el.dismiss(),200)}function ke(i){C.value=C.value.filter(l=>l.id!==i.id)}return Fe(async()=>{j.value=(await te.getTagList()).data.tags}),(i,l)=>{const u=Ke,y=Qe,T=je,V=me,he=ko,Se=pe,De=_e,X=We,Y=Xe,O=Ye,ie=Ze,p=Je,$e=eo,N=oo,we=no,Z=to,Pe=lo,J=ao,q=me,se=pe,ue=_e,re=io,Te=so,Ve=uo,Ne=ro,I=co,Le=mo,k=ho,de=po,Me=_o,Ae=fo,Ge=Ee,Be=Ue("tooltip");return s(),c(Ge,null,{default:o(()=>[e(De,null,{default:o(()=>[e(Se,null,{default:o(()=>[e(T,{slot:"start"},{default:o(()=>[e(y,{color:"dark","router-link":"/firmware/","router-direction":"back"},{default:o(()=>[e(u,{slot:"icon-only",icon:"ioniconsChevronBack"in i?i.ioniconsChevronBack:t(vo)},null,8,["icon"])]),_:1})]),_:1}),e(V,null,{default:o(()=>[a("Firmware – Assign Devices to Deployment Group")]),_:1}),e(T,{slot:"end"},{default:o(()=>[e(he)]),_:1})]),_:1})]),_:1}),e(Ae,{fullscreen:!0,class:"ion-padding"},{default:o(()=>[e(O,{color:"medium"},{default:o(()=>[e(Y,null,{default:o(()=>[e(X,null,{default:o(()=>{var v;return[a(" Selected deployment group: "+r((v=P(t(b)))==null?void 0:v.name)+" (ID: "+r(t(b))+") ",1)]}),_:1})]),_:1})]),_:1}),t(R)?(s(),c(O,{key:0,color:"success"},{default:o(()=>[e(ie,null,{default:o(()=>[e(X,null,{default:o(()=>[a(" Devices Assigned ")]),_:1})]),_:1}),e(Y,null,{default:o(()=>[e(p,null,{default:o(()=>{var v;return[f("p",null,[a(" Devices were successfully assigned to deployment group "),f("b",null,r((v=P(t(b)))==null?void 0:v.name)+" (ID: "+r(t(b))+")",1)])]}),_:1})]),_:1})]),_:1})):_("",!0),e(O,{class:"device-card"},{default:o(()=>[e(ie,null,{default:o(()=>[e(X,null,{default:o(()=>[a("Device Search")]),_:1}),e($e,null,{default:o(()=>[a(" Search for devices to add to the deployment group ")]),_:1})]),_:1}),e(Y,null,{default:o(()=>{var v,L;return[e(I,{lines:"none"},{default:o(()=>[e(we,{slot:"start",label:"Filter Parameter","label-placement":"floating",placeholder:"Select a filter",modelValue:t(h),"onUpdate:modelValue":l[0]||(l[0]=n=>A(h)?h.value=n:null),style:{"min-width":"19ch","flex-grow":"0"},onIonChange:l[1]||(l[1]=n=>W())},{default:o(()=>[e(N,{value:"ProductSerial"},{default:o(()=>[a(" Product Serial ")]),_:1}),e(N,{value:"ProductSerialId"},{default:o(()=>[a(" Product Serial ID ")]),_:1}),e(N,{value:"DataMatrixCode"},{default:o(()=>[a(" Data Matrix Code ")]),_:1}),e(N,{value:"DeviceHash"},{default:o(()=>[a(" Device Hash ")]),_:1}),e(N,{value:"SerialNumber"},{default:o(()=>[a(" Serial Number ")]),_:1})]),_:1},8,["modelValue"]),f("div",$o,[f("div",wo,[e(Z,{ref_key:"inputRef",ref:m,type:"text","error-text":"No assignable devices found",placeholder:"Enter one or more parameters to search (separated by a space)",modelValue:t(D),"onUpdate:modelValue":l[2]||(l[2]=n=>A(D)?D.value=n:null),autofocus:"",onIonInput:l[3]||(l[3]=n=>W()),onKeyup:l[4]||(l[4]=ce(n=>E(),["enter"]))},null,8,["modelValue"]),t(h)==="SerialNumber"?(s(),c(Z,{key:0,type:"text",class:"ion-margin-start","error-text":" ",placeholder:"Product Code",modelValue:t(z),"onUpdate:modelValue":l[5]||(l[5]=n=>A(z)?z.value=n:null),onIonInput:l[6]||(l[6]=n=>W()),onKeyup:l[7]||(l[7]=ce(n=>E(),["enter"]))},null,8,["modelValue"])):_("",!0)]),f("div",null,[Oe(e(Pe,{"aria-label":"Restrict using tags",modelValue:t($),"onUpdate:modelValue":l[8]||(l[8]=n=>A($)?$.value=n:null),style:{display:"inline-block",width:"unset"}},null,8,["modelValue"]),[[Be,"Restrict using tags"]]),f("span",{style:qe(`opacity: ${t($)?1:.5};`)},[e(Te,{class:"flex-wrap"},{default:o(()=>[t(C).length===0?(s(),c(p,{key:0,color:"medium"},{default:o(()=>[a(" No tags chosen ")]),_:1})):_("",!0),(s(!0),G(oe,null,ee(t(C),n=>(s(),c(J,{title:`${n.description} (${n.id})`,color:"medium"},{default:o(()=>[a(r(n.name.toUpperCase())+" ",1),e(u,{icon:"ioniconsClose"in i?i.ioniconsClose:t(ne),onClick:x=>ke(n)},null,8,["icon","onClick"])]),_:2},1032,["title"]))),256)),e(J,{color:"primary",title:"Add tag",id:"result-tag-button"},{default:o(()=>[a(" + ")]),_:1}),e(re,{trigger:"result-tag-button",class:"result-filter-modal",ref_key:"resultTagsModal",ref:Q},{default:o(()=>[e(ue,null,{default:o(()=>[e(se,null,{default:o(()=>[e(q,null,{default:o(()=>[a("Choose a tag")]),_:1}),e(y,{onClick:l[9]||(l[9]=n=>t(Q).$el.dismiss()),slot:"end",fill:"clear",color:"dark"},{default:o(()=>[e(u,{icon:"ioniconsClose"in i?i.ioniconsClose:t(ne),size:"medium"},null,8,["icon"])]),_:1})]),_:1})]),_:1}),f("div",Po,[(s(!0),G(oe,null,ee(t(j).filter(n=>!t(C).includes(n)),n=>(s(),c(J,{title:`${n.description} (${n.id})`,color:"medium",onClick:x=>Ce(n)},{default:o(()=>[a(" + "+r(n.name.toUpperCase()),1)]),_:2},1032,["title","onClick"]))),256)),t(C).length===t(j).length?(s(),c(p,{key:0,color:"medium"},{default:o(()=>[To]),_:1})):_("",!0)])]),_:1},512)]),_:1})],4)]),e(Ve,{class:"ion-align-items-center"},{default:o(()=>[Vo,e(y,{size:"small",color:"medium",fill:"outline",id:"result-limit-button",style:{"margin-inline":"0.75ch"}},{default:o(()=>[a(r(t(w)),1)]),_:1}),e(re,{trigger:"result-limit-button",class:"result-filter-modal",ref_key:"resultLimitModal",ref:le},{default:o(()=>[e(ue,null,{default:o(()=>[e(se,null,{default:o(()=>[e(q,null,{default:o(()=>[a("Result Limit")]),_:1}),e(y,{onClick:l[10]||(l[10]=n=>t(le).$el.dismiss()),slot:"end",fill:"clear",color:"dark"},{default:o(()=>[e(u,{icon:"ioniconsClose"in i?i.ioniconsClose:t(ne),size:"medium"},null,8,["icon"])]),_:1})]),_:1})]),_:1}),f("div",No,[e(Z,{type:"number",fill:"solid",label:"Max number of results",modelValue:t(w),"onUpdate:modelValue":l[11]||(l[11]=n=>A(w)?w.value=n:null)},null,8,["modelValue"])])]),_:1},512),Lo]),_:1})]),t(U)?(s(),c(Ne,{key:0,slot:"end",size:"small",color:"primary",name:"crescent"})):_("",!0),e(u,{slot:"end",label:"Clear input",icon:"ioniconsBackspace"in i?i.ioniconsBackspace:t(go),onClick:l[12]||(l[12]=n=>ae())},null,8,["icon"]),e(y,{class:"ion-margin-start",slot:"end",color:"primary",onClick:l[13]||(l[13]=n=>E()),disabled:t(U)},{default:o(()=>[e(p,null,{default:o(()=>[a("Query")]),_:1})]),_:1},8,["disabled"])]),_:1}),((v=t(g))==null?void 0:v.length)>0?(s(),G("div",Mo,[e(q,{class:"ion-no-padding ion-margin-start"},{default:o(()=>{var n;return[a(" Found "+r(((n=t(g))==null?void 0:n.length)??0)+" assignable devices: ",1)]}),_:1}),e(Le,{class:"ion-margin-start"},{default:o(()=>[a(" Please check this list thoroughly before assigning the devices to the deployment group ")]),_:1})])):_("",!0),((L=t(g))==null?void 0:L.length)>0?(s(),c(de,{key:1},{default:o(()=>[(s(!0),G(oe,null,ee(t(g),(n,x)=>(s(),c(I,{key:n.productSerial},{default:o(()=>[e(de,{style:{width:"100%"}},{default:o(()=>[e(q,{class:"device-title"},{default:o(()=>{var M;return[a("Device "+r(x+1)+" / "+r(((M=t(g))==null?void 0:M.length)??0),1)]}),_:2},1024),n.productSerial?(s(),c(I,{key:0,lines:"none",class:"device-item"},{default:o(()=>[e(u,{slot:"start",color:"medium",icon:"ioniconsPricetag"in i?i.ioniconsPricetag:t(S)},null,8,["icon"]),e(p,{class:"device-label"},{default:o(()=>[a("Product Serial:")]),_:1}),e(k,null,{default:o(()=>[a(r(n.productSerial),1)]),_:2},1024)]),_:2},1024)):_("",!0),n.productSerialId?(s(),c(I,{key:1,lines:"none",class:"device-item"},{default:o(()=>[e(u,{slot:"start",color:"medium",icon:"ioniconsPricetag"in i?i.ioniconsPricetag:t(S)},null,8,["icon"]),e(p,{class:"device-label"},{default:o(()=>[a("Product Serial ID:")]),_:1}),e(k,null,{default:o(()=>[a(r(n.productSerialId),1)]),_:2},1024)]),_:2},1024)):_("",!0),n.productCode?(s(),c(I,{key:2,lines:"none",class:"device-item"},{default:o(()=>[e(u,{slot:"start",color:"medium",icon:"ioniconsPricetag"in i?i.ioniconsPricetag:t(S)},null,8,["icon"]),e(p,{class:"device-label"},{default:o(()=>[a("Product Code:")]),_:1}),e(k,null,{default:o(()=>[a(r(n.productCode),1)]),_:2},1024)]),_:2},1024)):_("",!0),n.serialNumber?(s(),c(I,{key:3,lines:"none",class:"device-item"},{default:o(()=>[e(u,{slot:"start",color:"medium",icon:"ioniconsPricetag"in i?i.ioniconsPricetag:t(S)},null,8,["icon"]),e(p,{class:"device-label"},{default:o(()=>[a("Product Number:")]),_:1}),e(k,null,{default:o(()=>[a(r(n.serialNumber),1)]),_:2},1024)]),_:2},1024)):_("",!0),n.dataMatrixCode?(s(),c(I,{key:4,lines:"none",class:"device-item"},{default:o(()=>[e(u,{slot:"start",color:"medium",icon:"ioniconsPricetag"in i?i.ioniconsPricetag:t(S)},null,8,["icon"]),e(p,{class:"device-label"},{default:o(()=>[a("Data Matrix Code:")]),_:1}),e(k,null,{default:o(()=>[a(r(n.dataMatrixCode),1)]),_:2},1024)]),_:2},1024)):_("",!0),n.deviceHash?(s(),c(I,{key:5,lines:"none",class:"device-item"},{default:o(()=>[e(u,{slot:"start",color:"medium",icon:"ioniconsPricetag"in i?i.ioniconsPricetag:t(S)},null,8,["icon"]),e(p,{class:"device-label"},{default:o(()=>[a("Device Hash:")]),_:1}),e(k,null,{default:o(()=>[a(r(n.deviceHash),1)]),_:2},1024)]),_:2},1024)):_("",!0),e(I,{lines:"none",class:"device-item"},{default:o(()=>[e(u,{slot:"start",color:"medium",icon:"ioniconsApps"in i?i.ioniconsApps:t(yo)},null,8,["icon"]),e(p,{class:"device-label"},{default:o(()=>[a("Current Group:")]),_:1}),e(p,null,{default:o(()=>{var M;return[a(r((M=P(n.groupId))==null?void 0:M.name)+" (ID: ",1),e(k,null,{default:o(()=>[a(r(n.groupId),1)]),_:2},1024),a(") ")]}),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})):t(g)?(s(),G("div",Ao,[e(p,{color:"medium"},{default:o(()=>[Go]),_:1})])):_("",!0)]}),_:1})]),_:1}),e(Me,{slot:"fixed",vertical:"bottom",horizontal:"center"},{default:o(()=>[e(O,{class:"firmware-fab-card"},{default:o(()=>{var v,L,n;return[e(p,{color:"dark",innerHTML:t(F)?`Are you sure that you want to assign <b>${("pluralize"in i?i.pluralize:t(Do))(((v=t(g))==null?void 0:v.length)??0,"device")}</b> to deployment group <b>${(L=P(t(b)))==null?void 0:L.name} (ID: ${t(b)})</b>?`:`Search for devices to apply to deployment group <b>${(n=P(t(b)))==null?void 0:n.name} (ID: ${t(b)})</b>`},null,8,["innerHTML"]),f("div",null,[e(y,{color:"medium","router-link":"/firmware/","router-direction":"back"},{default:o(()=>[a(" Cancel ")]),_:1}),e(y,{onClick:l[14]||(l[14]=x=>Ie()),disabled:!t(F)||t(R)},{default:o(()=>[a(" Assign to Deployment Group ")]),_:1},8,["disabled"])])]}),_:1})]),_:1})]),_:1})]),_:1})}}}),Oo=Co(Bo,[["__scopeId","data-v-2ea7ee6a"]]);export{Oo as default};
