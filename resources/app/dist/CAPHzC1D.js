import{m as Ge,d as Ee,ag as Ct,b6 as Nn,K as De,r as J,t as L,v as Y,L as z,A as m,z as u,N as c,b7 as In,B as q,y as se,ax as it,R as Z,Q as ce,ai as Ko,b8 as Qo,ay as bt,P as Ke,ao as un,ab as Pe,a4 as Re,X as $e,Y as Je,Z as Ye,a3 as Mn,a2 as cn,b9 as zo,ac as xe,W as Xe,aH as at,ar as st,O as ne,ba as On,af as Et,a1 as St,aK as It,aL as Pt,bb as Fn,J as $n,c as X,bc as Pn,o as dn,bd as jo,ad as Wo,x as pe,aT as Go,be as Jo,bf as Yo,aN as ve,b as xo,aa as Xo,bg as Zo,bh as nn,$ as er,bi as tr,_ as Ue,bj as Be,e as ht,bk as nr,am as Un,bl as Vn,bm as qn,bn as Hn,bo as Kn,bp as or,bq as Qn,br as ie,bs as rr,bt as ir,bu as ar,bv as sr,bw as lr,bx as ur,aQ as cr,by as Oe,bz as _e,bA as ye,bB as dr,bC as le,bD as tt,bE as fr,bF as mr,bG as ue,bH as gr,bI as pr,bJ as zn,bK as jn,bL as Tn,bM as jt,bN as ge,ah as vr,bO as hr,bP as _r,ap as yr,as as wr,aq as Wn,aj as Gn,bQ as Cr,aX as br,a9 as Er,C as Sr,D as Ir,bR as Pr,bS as Tr,M as Ar,V as Rr,bT as kr}from"./0fV2q4Ox.js";import{_ as Dr}from"./logout.js";import{b as Lr,g as Jn,d as Tt,f as Br,e as ot,j as Nr,k as Mr,p as An,m as Or,w as He,l as Fr}from"./D0r5xylr.js";import{_ as $r}from"./Bv5F-E67.js";import{f as Ur,u as Vr,e as qr,a as fn}from"./M_3S_cE4.js";import{i as _t}from"./BThVWU2R.js";import{f as Hr}from"./BJaqhUnt.js";import{_ as Kr,a as Qr}from"./CEjZCPuH.js";import{_ as zr}from"./CxwSbNEQ.js";import{t as jr}from"./DNvL382Z.js";import{l as Wr}from"./DIg-daCs.js";import"./BYx_WZxC.js";const{$api:Wt}=Ge();function Gr(e){const t=new Set;for(const n of e){if(n.qrCode.length>0&&t.has(n.qrCode))return n;t.add(n.qrCode)}return null}async function Yn(e,t,n){if(e.length===0)throw new Error("QR code must not be empty when creating a device");const{data:i}=await Wt.createDevice({createDeviceRequest:{productVariantId:t,remarks:`Auto created by ${n??"fab app"} on ${new Date().toDateString()}`}}),r=i.deviceIdentifiers[0].productSerialId,o=Lr(e);return await Wt.setDataMatrixCode({setDataMatrixCodeRequest:{identifiers:[{dataMatrixCode:o,productSerialId:r}]}}),(await Wt.deviceList({deviceListRequest:{identifierType:"DataMatrixCode",identifierValues:[o]}})).data.devices[0]}const xn=Ee({__name:"batchButton",props:{devices:{},toggleOpen:{},single:{type:Boolean}},emits:["update:deviceConfig","update:isOpen"],setup(e){const t=Ct(),n=Nn(),i=e,{$api:r}=Ge();De(()=>i.toggleOpen,()=>{s.value=!s.value});const o=J(!1),s=J(!1),a=J(""),l=B=>{s.value=B,B&&w()},p=J([]);function w(){for(const B of i.devices)B.qrCode="";a.value=""}function E(B){B<p.value.length?p.value[B].$el.children[0].setFocus():T()}async function T(){if(i.devices.find(k=>k.qrCode.length===0)!==void 0){a.value="â›” Error: Empty QR code field detected!";return}const h=Gr(i.devices);if(h!==null){a.value=`â›” Error: Duplicate QR code ${h.qrCode} detected!`;return}o.value=!0;const g=i.devices.map(({qrCode:k})=>r.deviceList({deviceListRequest:Jn(k)})),b=await Promise.allSettled(g);for(const[k,F]of i.devices.entries()){const _=b[k];_.status==="fulfilled"?F.data=_.value.data.devices[0]??null:(F.data=null,F.qrCode="",console.error("deviceList rejected:",_.reason))}const I=i.devices.filter(k=>k.data===null&&k.qrCode.length>0);try{if(t.value.autoCreate&&I.length>0){const{variantId:k}=t.value,F=n.value.email.split("@")[0],_=I.map(v=>Yn(v.qrCode,k,F).then(P=>v.data=P)),S=await Promise.allSettled(_);for(const v of S)if(v.status==="rejected"){o.value=!1;const P=v.reason,U=P instanceof Error?P.message:JSON.stringify(P);throw new Error(U)}}}catch(k){console.error(k)}finally{o.value=!1,l(!1)}}function d(){i.devices.length>0&&E(0)}function M(B,h){B.qrCode="",a.value="",un(()=>E(h))}function O(B){B.qrCode=`FAB-${Date.now()}`}return(B,h)=>{const g=Pe,b=Re,I=$e,k=Je,F=Ye,_=Mn,S=cn,v=zo,P=xe,U=Xe,Q=at,H=st;return L(),Y(Z,null,[i.single?(L(),z(b,{key:0,onClick:h[0]||(h[0]=C=>l(!0)),fill:"clear",color:"light",title:"Scan QR-Code"},{default:m(()=>[u(g,{color:"dark",slot:"icon-only",icon:"ioniconsQrCode"in B?B.ioniconsQrCode:c(In)},null,8,["icon"])]),_:1})):(L(),z(b,{key:1,color:"tertiary",onClick:h[1]||(h[1]=C=>l(!0))},{default:m(()=>[u(g,{slot:"start",icon:"ioniconsQrCode"in B?B.ioniconsQrCode:c(In)},null,8,["icon"]),q(" Load batch ")]),_:1})),u(H,{"is-open":c(s),onWillDismiss:h[5]||(h[5]=C=>l(!1)),onDidPresent:d},{default:m(()=>[u(F,null,{default:m(()=>[u(k,null,{default:m(()=>[u(I,null,{default:m(()=>[q(se(i.single?"Scan QR":"Load Batch"),1)]),_:1}),u(b,{onClick:h[2]||(h[2]=C=>l(!1)),slot:"end",fill:"default"},{default:m(()=>[u(g,{icon:"ioniconsClose"in B?B.ioniconsClose:c(it),size:"medium"},null,8,["icon"])]),_:1})]),_:1})]),_:1}),u(P,{class:"ion-padding"},{default:m(()=>[(L(!0),Y(Z,null,ce(i.devices,(C,y)=>(L(),z(S,{ref_for:!0,ref_key:"qrRefs",ref:p},{default:m(()=>[u(_,{type:"text",autofocus:y===0,label:`${y+1}. QR Code`,modelValue:C.qrCode,"onUpdate:modelValue":R=>C.qrCode=R,onKeyup:Ko(R=>E(y+1),["enter"])},null,8,["autofocus","label","modelValue","onUpdate:modelValue","onKeyup"]),u(g,{slot:"end",label:"Create random data matrix code",color:"primary",icon:"ioniconsColorWand"in B?B.ioniconsColorWand:c(Qo),onClick:R=>O(C)},null,8,["icon","onClick"]),u(g,{slot:"end",label:"Clear input",icon:"ioniconsBackspace"in B?B.ioniconsBackspace:c(bt),onClick:R=>M(C,y)},null,8,["icon","onClick"])]),_:2},1536))),256)),u(v,{"is-open":c(o),message:"Loading...",spinner:"crescent"},null,8,["is-open"])]),_:1}),u(Q,null,{default:m(()=>[u(k,null,{default:m(()=>[u(S,{lines:"none"},{default:m(()=>[u(_,{type:"text",modelValue:c(a),"onUpdate:modelValue":h[3]||(h[3]=C=>Ke(a)?a.value=C:null),readonly:""},null,8,["modelValue"])]),_:1}),u(U,{slot:"end"},{default:m(()=>[u(b,{color:"primary",strong:!0,onClick:h[4]||(h[4]=C=>T())},{default:m(()=>[q(" Submit ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["is-open"])],64)}}}),Jr=Ee({__name:"picKitDevice",props:{config:{},index:{}},setup(e){const t=e,n=Ur(),i=n.update;async function r(){t.config.programmerId=""}return(o,s)=>{const a=Et,l=St,p=Pe,w=cn;return L(),z(w,null,{default:m(()=>[u(l,{modelValue:o.config.programmerId,"onUpdate:modelValue":s[0]||(s[0]=E=>o.config.programmerId=E),class:"select",placeholder:"Select Device Id",label:`PICkit Device ${o.index+1}`},{default:m(()=>[(L(!0),Y(Z,null,ce(c(n),({serialNo:E})=>(L(),z(a,{value:E},{default:m(()=>[q(se(E),1)]),_:2},1032,["value"]))),256)),c(n).length===0?(L(),z(a,{key:0,value:""},{default:m(()=>[q(" No devices detected ")]),_:1})):ne("",!0)]),_:1},8,["modelValue","label"]),u(p,{slot:"end",color:o.config.programmerId.length===0?"light":"medium",icon:"ioniconsBackspace"in o?o.ioniconsBackspace:c(bt),onClick:s[1]||(s[1]=E=>r())},null,8,["color","icon"]),u(p,{slot:"end",color:"tertiary",icon:"ioniconsRefresh"in o?o.ioniconsRefresh:c(On),onClick:s[2]||(s[2]=E=>c(i)())},null,8,["icon"])]),_:1})}}});var Yr={};const xr=Ee({__name:"button",setup(e){const{$api:t}=Ge(),{request:n,newMsgId:i}=It(Pt.IPC_FLASH),r=J(),o=J(!1),s=C=>o.value=C,{hasRole:a}=Fn(),l=Vr(),p=$n(),w=X(()=>p.value.length===1?p.value[0].variants:[]),E=qr(),T=J({}),d=Ct(),M=X(()=>Tt({product:l.value.find(({id:C})=>C===d.value.productId)})),O=X(()=>Pn.flash[M.value]),B=[{speed:0,name:"Minimum"},{speed:1,name:"Medium"},{speed:2,name:"Maximum"}],h=X(()=>[1,3].includes(d.value.productId)),g=X(()=>[2,7].includes(d.value.productId)),b=X(()=>(T.value[d.value.productId]??[]).filter(C=>d.value.productionMode?C.type.id===2:!0).filter(C=>!C.firmware.name.includes("OTA")).reverse());De(()=>d.value.productId,async C=>{const{data:y}=await t.productVariantList({productVariantListRequest:{productId:C}});p.value=y.products,d.value.variantId=y.products.length>0&&y.products[0].variants.length>0?y.products[0].variants[0].id:-1,d.value.firmwareReleaseId=null});function I(C){let y=d.value.devices.length;const R=parseInt(C.target.value);for(;R>y;)d.value.devices.push({qrCode:"",data:null,comPortSerial:"",comPortCamera:"",comPortPlc:"",programmerId:""}),y++;for(;R<y;)d.value.devices.pop(),y--}function k(){var C;(C=r.value)==null||C.click()}function F(C){const R=C.target.files;if(!R)return;const j=R[0];j&&(d.value.microchipBinPath=j.path)}async function _(){try{const C=await n({type:ve.READ_FILE_REQUEST,id:i()},864e5);d.value=JSON.parse(C.content)}catch(C){await _t(C)}}async function S(){try{const y=`${Yr.USERPROFILE}\\Documents\\flash-settings-${Hr()}.json`,R={...d.value};R.devices.forEach(j=>{j.data=null,j.qrCode=""}),await n({type:ve.SAVE_FILE_REQUEST,id:i(),path:y,content:JSON.stringify(R,null,2)},864e5)}catch(C){await _t(C)}}function v(){xo(()=>{const C=document.querySelector("ion-alert.select-alert");C==null||C.classList.add("firmware-select-alert")})}async function P(){if(await E.update(),E.value.length>0){const C=E.value.map(j=>j.id),y=E.value.reduce((j,G)=>(j[G.product.id]?j[G.product.id].push(G.id):j[G.product.id]=[G.id],j),{}),R=[...new Set(E.value.map(j=>j.product.id))];await U(C,R,y)}}async function U(C,y,R){const{data:j}=await t.getFirmwareReleaseList({getFirmwareReleaseListRequest:{firmwareIds:C}}),G=j.firmwareReleases.reverse();y.forEach(ee=>T.value[ee]=G.filter(de=>R[ee].includes(de.firmware.id)))}function Q(C,y){var R,j,G;return((G=(j=(R=O.value)==null?void 0:R.stages)==null?void 0:j.find(ee=>(ee.fileTypeId??-1)===y))==null?void 0:G.filename)??C}async function H(){const y=T.value[d.value.productId].find(R=>R.id===d.value.firmwareReleaseId);y&&y.files.forEach(async R=>{const{data:j}=await t.getFirmwareFile({getFirmwareFileRequest:{firmwareFileIds:[R.id]}}),G=j.firmwareFiles[0];if(G===void 0)throw new Error(`Firmware not found for id ${R.id}`);if(G.download===void 0)throw new Error(`Firmware download not available for id ${R.id}`);const ee=await fetch(G.download.url).then(he=>he.arrayBuffer()),{message:de}=await n({type:ve.DOWNLOAD_FIRMWARE_FILE_REQUEST,id:i(),productCode:d.value.productId,fileName:Q(R.name,R.type.id),fileType:G.type.id,encryptedFileContent:ee,decryptionKey:G.encryptionKey,fileVersion:G.version,fileHash:G.fileHash,releaseId:d.value.firmwareReleaseId,remarks:G.remarks});console.log("ðŸ“",de)})}return dn(async()=>{d.value.microchipBinPath||(d.value.microchipBinPath=Pn.flash.microchip.bin),await P(),d.value.firmwareReleaseId&&H()}),(C,y)=>{const R=Pe,j=Re,G=$e,ee=Je,de=Ye,he=Et,A=St,$=cn,V=Xo,ae=Mn,x=$r,oe=Jr,te=xe,Se=Xe,Ie=at,ke=st;return L(),Y(Z,null,[u(j,{color:"light",onClick:y[0]||(y[0]=N=>s(!0))},{default:m(()=>[u(R,{color:"medium",icon:"ioniconsSettingsSharp"in C?C.ioniconsSettingsSharp:c(jo)},null,8,["icon"])]),_:1}),u(ke,{class:"settings","is-open":c(o),onWillDismiss:y[23]||(y[23]=N=>s(!1))},{default:m(()=>[u(de,null,{default:m(()=>[u(ee,null,{default:m(()=>[u(G,null,{default:m(()=>[q("Settings")]),_:1}),u(j,{onClick:y[1]||(y[1]=N=>s(!1)),slot:"end",fill:"default"},{default:m(()=>[u(R,{icon:"ioniconsClose"in C?C.ioniconsClose:c(it),size:"medium"},null,8,["icon"])]),_:1})]),_:1})]),_:1}),u(te,{class:"ion-padding"},{default:m(()=>[u($,{lines:"none"},{default:m(()=>[u(A,{modelValue:c(d).productId,"onUpdate:modelValue":y[2]||(y[2]=N=>c(d).productId=N),class:"select",placeholder:"Select product",label:"Product to create",interface:"action-sheet"},{default:m(()=>[(L(!0),Y(Z,null,ce(c(l),({name:N,id:re})=>(L(),z(he,{value:re},{default:m(()=>[q(se(N),1)]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"])]),_:1}),u($,{lines:"none"},{default:m(()=>[u(A,{modelValue:c(d).variantId,"onUpdate:modelValue":y[3]||(y[3]=N=>c(d).variantId=N),class:"select",placeholder:"Select variant",label:"Variant to create",interface:"action-sheet"},{default:m(()=>[(L(!0),Y(Z,null,ce([...c(w)].reverse(),N=>(L(),z(he,{value:N.id,title:N.remarks},{default:m(()=>[q(se(("toRaw"in C?C.toRaw:c(Wo))(("formatVariant"in C?C.formatVariant:c(Br))(N))),1)]),_:2},1032,["value","title"]))),256))]),_:1},8,["modelValue"])]),_:1}),u($,{lines:"none"},{default:m(()=>[u(A,{modelValue:c(d).firmwareReleaseId,"onUpdate:modelValue":y[4]||(y[4]=N=>c(d).firmwareReleaseId=N),class:"select",placeholder:"Select firmware",label:"Firmware to flash",onClick:y[5]||(y[5]=N=>v()),onIonChange:y[6]||(y[6]=N=>H())},{default:m(()=>[(L(!0),Y(Z,null,ce(c(b),N=>(L(),z(he,{value:N.id,title:N.remarks},{default:m(()=>[q(se(N.tag)+" â€“ "+se(N.creationTimeStamp.toLocaleDateString("de-DE"))+" â€“ "+se(N.remarks),1)]),_:2},1032,["value","title"]))),256))]),_:1},8,["modelValue"]),u(R,{slot:"end",color:"tertiary",icon:"ioniconsRefresh"in C?C.ioniconsRefresh:c(On),onClick:y[7]||(y[7]=N=>P())},null,8,["icon"])]),_:1}),u($,null,{default:m(()=>[u(V,{onIonChange:y[8]||(y[8]=N=>c(d).autoCreate=N.detail.checked),checked:c(d).autoCreate},{default:m(()=>[q(" Auto create device ")]),_:1},8,["checked"])]),_:1}),u($,null,{default:m(()=>[u(V,{onIonChange:y[9]||(y[9]=N=>c(d).productionMode=N.detail.checked),checked:c(d).productionMode},{default:m(()=>[q(" Production Mode (firmware protection) âš ï¸ ")]),_:1},8,["checked"])]),_:1}),c(g)?(L(),z($,{key:0},{default:m(()=>[u(V,{onIonChange:y[10]||(y[10]=N=>c(d).plcMode=N.detail.checked),checked:c(d).plcMode},{default:m(()=>[q(" PLC Mode (flash using PLC bridge) ")]),_:1},8,["checked"])]),_:1})):ne("",!0),c(g)?(L(),z($,{key:1},{default:m(()=>[u(V,{onIonChange:y[11]||(y[11]=N=>c(d).eraseBeforeFlash=N.detail.checked),checked:c(d).eraseBeforeFlash},{default:m(()=>[q(" Erase device before flashing (inverter only) ")]),_:1},8,["checked"])]),_:1})):ne("",!0),c(g)?(L(),z($,{key:2},{default:m(()=>[u(V,{onIonChange:y[12]||(y[12]=N=>c(d).verifyOtp=N.detail.checked),checked:c(d).verifyOtp},{default:m(()=>[q(" Verify OTP memory after flash (inverter only) ")]),_:1},8,["checked"])]),_:1})):ne("",!0),c(g)?(L(),z($,{key:3},{default:m(()=>[u(V,{onIonChange:y[13]||(y[13]=N=>c(d).retryWithoutOtp=N.detail.checked),checked:c(d).retryWithoutOtp},{default:m(()=>[q(" Retry without OTP (use when re-flashing inverters only) ")]),_:1},8,["checked"])]),_:1})):ne("",!0),u($,null,{default:m(()=>[u(V,{onIonChange:y[14]||(y[14]=N=>c(d).cameraMode=N.detail.checked),checked:c(d).cameraMode},{default:m(()=>[q(" Camera mode (scan data matrix code with usb camera) ")]),_:1},8,["checked"])]),_:1}),c(h)?(L(),z($,{key:4},{default:m(()=>[u(V,{onIonChange:y[15]||(y[15]=N=>c(d).flashModeController=N.detail.checked),checked:c(d).flashModeController},{default:m(()=>[q(" IO9 Controller (open IO9 pin and run IG/IGB for 10s) ")]),_:1},8,["checked"])]),_:1})):ne("",!0),c(a)("Developer")?(L(),z($,{key:5},{default:m(()=>[u(V,{onIonChange:y[16]||(y[16]=N=>c(d).dryRun=N.detail.checked),checked:c(d).dryRun},{default:m(()=>[q(" Dry Run (for debugging only) ")]),_:1},8,["checked"])]),_:1})):ne("",!0),c(g)?(L(),z($,{key:6,lines:"none"},{default:m(()=>[u(A,{modelValue:c(d).flashSpeed,"onUpdate:modelValue":y[17]||(y[17]=N=>c(d).flashSpeed=N),class:"select",placeholder:"Select flash speed",label:"Flash speed (inverter only)",interface:"action-sheet"},{default:m(()=>[(L(),Y(Z,null,ce(B,({speed:N,name:re})=>u(he,{value:N},{default:m(()=>[q(se(re),1)]),_:2},1032,["value"])),64))]),_:1},8,["modelValue"])]),_:1})):ne("",!0),c(g)?(L(),z($,{key:7},{default:m(()=>[u(ae,{modelValue:c(d).microchipBinPath,"onUpdate:modelValue":y[18]||(y[18]=N=>c(d).microchipBinPath=N),label:"Microchip Binary",type:"text",class:"ion-text-right"},null,8,["modelValue"]),pe("input",{style:{display:"none"},type:"file",ref_key:"microchipBinPathRef",ref:r,onChange:F},null,544),u(R,{class:"ion-margin-start",icon:"ioniconsDocument"in C?C.ioniconsDocument:c(Go),color:"tertiary",style:{cursor:"pointer"},onClick:y[19]||(y[19]=N=>k())},null,8,["icon"])]),_:1})):ne("",!0),u($,null,{default:m(()=>[u(ae,{value:c(d).devices.length,onInput:I,label:"Device count",type:"number",inputmode:"numeric",class:"ion-text-right"},null,8,["value"])]),_:1}),c(h)&&c(d).flashModeController?(L(),z(x,{key:8,modelValue:c(d).comPortFlashModeController,"onUpdate:modelValue":y[20]||(y[20]=N=>c(d).comPortFlashModeController=N),title:"IO9 Controller (factory)"},null,8,["modelValue"])):ne("",!0),c(h)?(L(!0),Y(Z,{key:9},ce(c(d).devices.entries(),([N,re])=>(L(),z(x,{modelValue:re.comPortPlc,"onUpdate:modelValue":Te=>re.comPortPlc=Te,title:`COM Flasher ${N+1}`},null,8,["modelValue","onUpdate:modelValue","title"]))),256)):ne("",!0),c(d).cameraMode?(L(!0),Y(Z,{key:10},ce(c(d).devices.entries(),([N,re])=>(L(),z(x,{modelValue:re.comPortCamera,"onUpdate:modelValue":Te=>re.comPortCamera=Te,title:`COM Camera ${N+1}`,"is-camera":!0},null,8,["modelValue","onUpdate:modelValue","title"]))),256)):ne("",!0),c(g)&&c(d).plcMode?(L(!0),Y(Z,{key:11},ce(c(d).devices.entries(),([N,re])=>(L(),z(x,{modelValue:re.comPortPlc,"onUpdate:modelValue":Te=>re.comPortPlc=Te,title:`COM PLC ${N+1}`},null,8,["modelValue","onUpdate:modelValue","title"]))),256)):ne("",!0),c(g)&&!c(d).plcMode?(L(!0),Y(Z,{key:12},ce(c(d).devices.entries(),([N,re])=>(L(),z(oe,{config:re,index:N},null,8,["config","index"]))),256)):ne("",!0)]),_:1}),u(Ie,null,{default:m(()=>[u(ee,null,{default:m(()=>[u(Se,{slot:"start"},{default:m(()=>[u(j,{class:"ion-padding-start",color:"medium",onClick:y[21]||(y[21]=N=>_())},{default:m(()=>[u(R,{slot:"start",icon:"ioniconsArrowUpCircle"in C?C.ioniconsArrowUpCircle:c(Jo)},null,8,["icon"]),q(" Import ")]),_:1}),u(j,{color:"medium",onClick:y[22]||(y[22]=N=>S())},{default:m(()=>[u(R,{slot:"start",icon:"ioniconsArrowDownCircle"in C?C.ioniconsArrowDownCircle:c(Yo)},null,8,["icon"]),q(" Export ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["is-open"])],64)}}}),Xr=Ee({__name:"testButton",props:{config:{}},setup(e){const{newMsgId:t,request:n}=It(Pt.IPC_FLASH),i=fn(!1),r=e,o=J([]),s=J(!1),a=X(()=>i.getBySerial(r.config.comPortSerial)),l=X(()=>Tt(r.config.data)),p=X(()=>ot(l.value)?a.value:r.config.programmerId),w=X(()=>a.value?`Test device on ${a.value}`:r.config.programmerId?`Test device on ${r.config.programmerId}`:"No COM port assigned");async function E(){if(ot(l.value)&&!a.value){o.value.push({header:"Configuration ErrorðŸ”Œ",subHeader:"No COM Port selected",message:"Click on the âš™ï¸ button to configure the COM port"});return}if(l.value===nn.MICROCHIP&&!r.config.programmerId){o.value.push({header:"Configuration ErrorðŸ”Œ",subHeader:"No Microchip Programmer selected",message:"Click on the âš™ï¸ button to configure the programmer"});return}try{s.value=!0;const T=await n({type:ve.FLASH_TEST_REQUEST,id:t(),comPortOrDeviceId:p.value,deviceType:l.value},6e4);o.value.push({header:"Successâš¡",subHeader:`Connected using ${p.value}`,message:T.message})}catch(T){const d=T instanceof Error?T.message:"Unknown";o.value.push({header:"Failed ðŸ˜µ",subHeader:"Is the device connected?",message:`Check for wobbly connections and correct pin mappingðŸ”Œ 
 Error: ${d}`})}finally{s.value=!1}}return(T,d)=>{var g,b,I;const M=er,O=Pe,B=Re,h=tr;return L(),Y(Z,null,[u(B,{onClick:E,fill:"clear",color:"light",title:c(w),disabled:!c(p)},{default:m(()=>[c(s)?(L(),z(M,{key:0,color:"warning",name:"crescent"})):(L(),z(O,{key:1,color:"warning",slot:"icon-only",icon:"ioniconsFlask"in T?T.ioniconsFlask:c(Zo)},null,8,["icon"]))]),_:1},8,["title","disabled"]),u(h,{"is-open":c(o).length>0,header:(g=c(o)[0])==null?void 0:g.header,"sub-header":(b=c(o)[0])==null?void 0:b.subHeader,message:(I=c(o)[0])==null?void 0:I.message,buttons:["ok"],onDidDismiss:d[0]||(d[0]=k=>o.value=[])},null,8,["is-open","header","sub-header","message"])],64)}}}),Zr=Ue(Xr,[["__scopeId","data-v-3ddfdfe3"]]),ei=100,ti=Ee({__name:"eraseButton",props:{config:{}},setup(e){const t=e,n=fn(!1),i=X(()=>n.getBySerial(t.config.comPortSerial)),r=X(()=>Tt(t.config.data)),o=X(()=>ot(r.value)?i.value:t.config.programmerId),s=X(()=>o.value?`Erase device using ${o.value}`:"No device assigned"),a=X(()=>{var P;return((P=t.config.data)==null?void 0:P.productSerial)??o.value}),l=J(!1),p=P=>{l.value=P,P?S(a.value):(v(),_())},{$db:w}=Ge(),{ipcSubject:E,newMsgId:T}=It(Pt.IPC_FLASH),d=J(),M=J(""),O=Object.entries(Be),B=J(Be.INFO);let h=null,g=null;const b=P=>Kn(()=>w.deviceLogs.where("productSerial").equals(P).limit(ei).reverse().toArray()),I=J([]);De(I,P=>{P&&(M.value=P.reverse().reduce((U,{timestamp:Q,level:H,message:C},y)=>{const R=new Date(Date.parse(Q)).toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit",fractionalSecondDigits:3});return U+(y===0?"":`\r
`)+`${R} [${H}]: ${C}`},""),un(()=>{d.value&&(d.value.scrollTop=d.value.scrollHeight)}))});async function k(){const P=t.config.data??{productSerial:o.value},U={type:ve.FLASH_ERASE_REQUEST,id:T(),deviceType:r.value,comPortOrDeviceId:o.value};g=E.pipe(qn(Q=>Q.id===U.id),Hn(Q=>{if(Q.type===ve.ERROR_RESPONSE)throw new Error(Q.reason)})).subscribe({next:Q=>{const H=new Date().toISOString();Q.type===ve.FLASH_LOG_UPDATE&&w.deviceLogs.add({level:Q.level,productSerial:P.productSerial,message:Q.message,timestamp:H}),Q.type===ve.ERROR_RESPONSE&&w.deviceLogs.add({level:Be.ERROR,productSerial:P.productSerial,message:Q.reason,timestamp:H})}}),E.next(U)}async function F(){await w.deviceLogs.where("productSerial").equals(a.value).delete()}function _(){h&&(h.unsubscribe(),h=null)}function S(P){_(),h=b(P).subscribe({next:U=>I.value=U})}function v(){g&&(g.unsubscribe(),g=null)}return ht(_),ht(v),(P,U)=>{const Q=Pe,H=Re,C=$e,y=Et,R=St,j=Je,G=Ye,ee=xe,de=Xe,he=at,A=st;return L(),Y(Z,null,[u(H,{onClick:U[0]||(U[0]=$=>p(!0)),fill:"clear",color:"light",title:c(s),disabled:!c(o)},{default:m(()=>[u(Q,{slot:"icon-only",color:"danger",icon:"ioniconsTrash"in P?P.ioniconsTrash:c(nr)},null,8,["icon"])]),_:1},8,["title","disabled"]),u(A,{"is-open":c(l),onWillDismiss:U[4]||(U[4]=$=>p(!1))},{default:m(()=>[u(G,null,{default:m(()=>[u(j,null,{default:m(()=>[u(C,null,{default:m(()=>[q("Logs for "+se(c(a)),1)]),_:1}),u(R,{class:"log-level-option",slot:"end",label:"Level",modelValue:c(B),"onUpdate:modelValue":U[1]||(U[1]=$=>Ke(B)?B.value=$:null)},{default:m(()=>[(L(!0),Y(Z,null,ce(c(O),([$,V])=>(L(),z(y,{key:V},{default:m(()=>[q(se(V),1)]),_:2},1024))),128))]),_:1},8,["modelValue"]),u(H,{onClick:U[2]||(U[2]=$=>p(!1)),slot:"end",fill:"default"},{default:m(()=>[u(Q,{icon:"ioniconsClose"in P?P.ioniconsClose:c(it),size:"medium"},null,8,["icon"])]),_:1})]),_:1})]),_:1}),u(ee,{class:"ion-padding"},{default:m(()=>[Un(pe("textarea",{class:"logs","onUpdate:modelValue":U[3]||(U[3]=$=>Ke(M)?M.value=$:null),placeholder:"No log entries",readonly:"",ref_key:"textarea",ref:d},null,512),[[Vn,c(M)]])]),_:1}),u(he,null,{default:m(()=>[u(j,null,{default:m(()=>[u(de,null,{default:m(()=>[u(H,{class:"ion-padding-start",fill:"solid",color:"warning",onClick:F},{default:m(()=>[q(" Clear ")]),_:1})]),_:1}),u(de,{slot:"end"},{default:m(()=>[u(H,{class:"ion-padding-end",fill:"solid",color:"danger",onClick:k},{default:m(()=>[q(" Erase ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["is-open"])],64)}}}),ni=Ue(ti,[["__scopeId","data-v-4791f53b"]]),oi=Ee({__name:"logButton",props:{productSerial:{}},setup(e){const t=e,n=J(1024),i=J(!1),r=h=>{i.value=h,h?M(t.productSerial):d()},{$db:o}=Ge(),s=J(),a=J(""),l=Object.entries(Be),p=J(Be.INFO);let w=null;const E=h=>Kn(()=>o.deviceLogs.where("productSerial").equals(h).limit(n.value).reverse().toArray()),T=J([]);function d(){w&&(w.unsubscribe(),w=null)}function M(h){d(),w=E(h).subscribe({next:g=>T.value=g})}De(T,h=>{h&&(a.value=h.reverse().reduce((g,{timestamp:b,level:I,message:k},F)=>{const _=new Date(Date.parse(b)).toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit",fractionalSecondDigits:3});return g+(F===0?"":`\r
`)+`${_} [${I}]: ${k}`},""),un(()=>{s.value&&(s.value.scrollTop=s.value.scrollHeight)}))},{immediate:!0});async function O(){await o.deviceLogs.add({productSerial:t.productSerial,timestamp:new Date().toISOString(),level:Be.INFO,message:"test message"})}async function B(){await o.deviceLogs.where("productSerial").equals(t.productSerial).delete()}return ht(d),(h,g)=>{const b=Pe,I=Re,k=$e,F=Et,_=St,S=Je,v=Ye,P=xe,U=Xe,Q=at,H=st;return L(),Y(Z,null,[u(I,{onClick:g[0]||(g[0]=C=>r(!0)),fill:"clear",color:"light",title:"Open log"},{default:m(()=>[u(b,{slot:"icon-only",color:"secondary",icon:"ioniconsDocumentText"in h?h.ioniconsDocumentText:c(or)},null,8,["icon"])]),_:1}),u(H,{class:"log","is-open":c(i),onWillDismiss:g[4]||(g[4]=C=>r(!1))},{default:m(()=>[u(v,null,{default:m(()=>[u(S,null,{default:m(()=>[u(k,null,{default:m(()=>[q("Logs for "+se(h.productSerial),1)]),_:1}),u(_,{class:"log-level-option",slot:"end",label:"Level",modelValue:c(p),"onUpdate:modelValue":g[1]||(g[1]=C=>Ke(p)?p.value=C:null)},{default:m(()=>[(L(!0),Y(Z,null,ce(c(l),([C,y])=>(L(),z(F,{key:y},{default:m(()=>[q(se(y),1)]),_:2},1024))),128))]),_:1},8,["modelValue"]),u(I,{onClick:g[2]||(g[2]=C=>r(!1)),slot:"end",fill:"default"},{default:m(()=>[u(b,{icon:"ioniconsClose"in h?h.ioniconsClose:c(it),size:"medium"},null,8,["icon"])]),_:1})]),_:1})]),_:1}),u(P,{class:"ion-padding"},{default:m(()=>[Un(pe("textarea",{class:"logs","onUpdate:modelValue":g[3]||(g[3]=C=>Ke(a)?a.value=C:null),placeholder:"No log entries",readonly:"",ref_key:"textarea",ref:s},null,512),[[Vn,c(a)]])]),_:1}),u(Q,null,{default:m(()=>[u(S,null,{default:m(()=>[u(U,{slot:"start"},{default:m(()=>[u(I,{class:"ion-padding-start",fill:"solid",color:"warning",onClick:B},{default:m(()=>[q(" Clear ")]),_:1})]),_:1}),u(U,{slot:"end"},{default:m(()=>[u(I,{class:"ion-padding-end",slot:"end",fill:"solid",color:"primary",onClick:O},{default:m(()=>[q(" Test ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["is-open"])],64)}}}),ri=Ue(oi,[["__scopeId","data-v-e6df437f"]]);var lt={},ii=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then},Xn={},we={};let mn;const ai=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];we.getSymbolSize=function(t){if(!t)throw new Error('"version" cannot be null or undefined');if(t<1||t>40)throw new Error('"version" should be in range from 1 to 40');return t*4+17};we.getSymbolTotalCodewords=function(t){return ai[t]};we.getBCHDigit=function(e){let t=0;for(;e!==0;)t++,e>>>=1;return t};we.setToSJISFunction=function(t){if(typeof t!="function")throw new Error('"toSJISFunc" is not a valid function.');mn=t};we.isKanjiModeEnabled=function(){return typeof mn<"u"};we.toSJIS=function(t){return mn(t)};var At={};(function(e){e.L={bit:1},e.M={bit:0},e.Q={bit:3},e.H={bit:2};function t(n){if(typeof n!="string")throw new Error("Param is not a string");switch(n.toLowerCase()){case"l":case"low":return e.L;case"m":case"medium":return e.M;case"q":case"quartile":return e.Q;case"h":case"high":return e.H;default:throw new Error("Unknown EC Level: "+n)}}e.isValid=function(i){return i&&typeof i.bit<"u"&&i.bit>=0&&i.bit<4},e.from=function(i,r){if(e.isValid(i))return i;try{return t(i)}catch{return r}}})(At);function Zn(){this.buffer=[],this.length=0}Zn.prototype={get:function(e){const t=Math.floor(e/8);return(this.buffer[t]>>>7-e%8&1)===1},put:function(e,t){for(let n=0;n<t;n++)this.putBit((e>>>t-n-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(e){const t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),e&&(this.buffer[t]|=128>>>this.length%8),this.length++}};var si=Zn;function ut(e){if(!e||e<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=e,this.data=new Uint8Array(e*e),this.reservedBit=new Uint8Array(e*e)}ut.prototype.set=function(e,t,n,i){const r=e*this.size+t;this.data[r]=n,i&&(this.reservedBit[r]=!0)};ut.prototype.get=function(e,t){return this.data[e*this.size+t]};ut.prototype.xor=function(e,t,n){this.data[e*this.size+t]^=n};ut.prototype.isReserved=function(e,t){return this.reservedBit[e*this.size+t]};var li=ut,eo={};(function(e){const t=we.getSymbolSize;e.getRowColCoords=function(i){if(i===1)return[];const r=Math.floor(i/7)+2,o=t(i),s=o===145?26:Math.ceil((o-13)/(2*r-2))*2,a=[o-7];for(let l=1;l<r-1;l++)a[l]=a[l-1]-s;return a.push(6),a.reverse()},e.getPositions=function(i){const r=[],o=e.getRowColCoords(i),s=o.length;for(let a=0;a<s;a++)for(let l=0;l<s;l++)a===0&&l===0||a===0&&l===s-1||a===s-1&&l===0||r.push([o[a],o[l]]);return r}})(eo);var to={};const ui=we.getSymbolSize,Rn=7;to.getPositions=function(t){const n=ui(t);return[[0,0],[n-Rn,0],[0,n-Rn]]};var no={};(function(e){e.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const t={N1:3,N2:3,N3:40,N4:10};e.isValid=function(r){return r!=null&&r!==""&&!isNaN(r)&&r>=0&&r<=7},e.from=function(r){return e.isValid(r)?parseInt(r,10):void 0},e.getPenaltyN1=function(r){const o=r.size;let s=0,a=0,l=0,p=null,w=null;for(let E=0;E<o;E++){a=l=0,p=w=null;for(let T=0;T<o;T++){let d=r.get(E,T);d===p?a++:(a>=5&&(s+=t.N1+(a-5)),p=d,a=1),d=r.get(T,E),d===w?l++:(l>=5&&(s+=t.N1+(l-5)),w=d,l=1)}a>=5&&(s+=t.N1+(a-5)),l>=5&&(s+=t.N1+(l-5))}return s},e.getPenaltyN2=function(r){const o=r.size;let s=0;for(let a=0;a<o-1;a++)for(let l=0;l<o-1;l++){const p=r.get(a,l)+r.get(a,l+1)+r.get(a+1,l)+r.get(a+1,l+1);(p===4||p===0)&&s++}return s*t.N2},e.getPenaltyN3=function(r){const o=r.size;let s=0,a=0,l=0;for(let p=0;p<o;p++){a=l=0;for(let w=0;w<o;w++)a=a<<1&2047|r.get(p,w),w>=10&&(a===1488||a===93)&&s++,l=l<<1&2047|r.get(w,p),w>=10&&(l===1488||l===93)&&s++}return s*t.N3},e.getPenaltyN4=function(r){let o=0;const s=r.data.length;for(let l=0;l<s;l++)o+=r.data[l];return Math.abs(Math.ceil(o*100/s/5)-10)*t.N4};function n(i,r,o){switch(i){case e.Patterns.PATTERN000:return(r+o)%2===0;case e.Patterns.PATTERN001:return r%2===0;case e.Patterns.PATTERN010:return o%3===0;case e.Patterns.PATTERN011:return(r+o)%3===0;case e.Patterns.PATTERN100:return(Math.floor(r/2)+Math.floor(o/3))%2===0;case e.Patterns.PATTERN101:return r*o%2+r*o%3===0;case e.Patterns.PATTERN110:return(r*o%2+r*o%3)%2===0;case e.Patterns.PATTERN111:return(r*o%3+(r+o)%2)%2===0;default:throw new Error("bad maskPattern:"+i)}}e.applyMask=function(r,o){const s=o.size;for(let a=0;a<s;a++)for(let l=0;l<s;l++)o.isReserved(l,a)||o.xor(l,a,n(r,l,a))},e.getBestMask=function(r,o){const s=Object.keys(e.Patterns).length;let a=0,l=1/0;for(let p=0;p<s;p++){o(p),e.applyMask(p,r);const w=e.getPenaltyN1(r)+e.getPenaltyN2(r)+e.getPenaltyN3(r)+e.getPenaltyN4(r);e.applyMask(p,r),w<l&&(l=w,a=p)}return a}})(no);var Rt={};const Le=At,mt=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],gt=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];Rt.getBlocksCount=function(t,n){switch(n){case Le.L:return mt[(t-1)*4+0];case Le.M:return mt[(t-1)*4+1];case Le.Q:return mt[(t-1)*4+2];case Le.H:return mt[(t-1)*4+3];default:return}};Rt.getTotalCodewordsCount=function(t,n){switch(n){case Le.L:return gt[(t-1)*4+0];case Le.M:return gt[(t-1)*4+1];case Le.Q:return gt[(t-1)*4+2];case Le.H:return gt[(t-1)*4+3];default:return}};var oo={},kt={};const nt=new Uint8Array(512),yt=new Uint8Array(256);(function(){let t=1;for(let n=0;n<255;n++)nt[n]=t,yt[t]=n,t<<=1,t&256&&(t^=285);for(let n=255;n<512;n++)nt[n]=nt[n-255]})();kt.log=function(t){if(t<1)throw new Error("log("+t+")");return yt[t]};kt.exp=function(t){return nt[t]};kt.mul=function(t,n){return t===0||n===0?0:nt[yt[t]+yt[n]]};(function(e){const t=kt;e.mul=function(i,r){const o=new Uint8Array(i.length+r.length-1);for(let s=0;s<i.length;s++)for(let a=0;a<r.length;a++)o[s+a]^=t.mul(i[s],r[a]);return o},e.mod=function(i,r){let o=new Uint8Array(i);for(;o.length-r.length>=0;){const s=o[0];for(let l=0;l<r.length;l++)o[l]^=t.mul(r[l],s);let a=0;for(;a<o.length&&o[a]===0;)a++;o=o.slice(a)}return o},e.generateECPolynomial=function(i){let r=new Uint8Array([1]);for(let o=0;o<i;o++)r=e.mul(r,new Uint8Array([1,t.exp(o)]));return r}})(oo);const ro=oo;function gn(e){this.genPoly=void 0,this.degree=e,this.degree&&this.initialize(this.degree)}gn.prototype.initialize=function(t){this.degree=t,this.genPoly=ro.generateECPolynomial(this.degree)};gn.prototype.encode=function(t){if(!this.genPoly)throw new Error("Encoder not initialized");const n=new Uint8Array(t.length+this.degree);n.set(t);const i=ro.mod(n,this.genPoly),r=this.degree-i.length;if(r>0){const o=new Uint8Array(this.degree);return o.set(i,r),o}return i};var ci=gn,io={},Ne={},pn={};pn.isValid=function(t){return!isNaN(t)&&t>=1&&t<=40};var Ae={};const ao="[0-9]+",di="[A-Z $%*+\\-./:]+";let rt="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";rt=rt.replace(/u/g,"\\u");const fi="(?:(?![A-Z0-9 $%*+\\-./:]|"+rt+`)(?:.|[\r
]))+`;Ae.KANJI=new RegExp(rt,"g");Ae.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g");Ae.BYTE=new RegExp(fi,"g");Ae.NUMERIC=new RegExp(ao,"g");Ae.ALPHANUMERIC=new RegExp(di,"g");const mi=new RegExp("^"+rt+"$"),gi=new RegExp("^"+ao+"$"),pi=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");Ae.testKanji=function(t){return mi.test(t)};Ae.testNumeric=function(t){return gi.test(t)};Ae.testAlphanumeric=function(t){return pi.test(t)};(function(e){const t=pn,n=Ae;e.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},e.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},e.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},e.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},e.MIXED={bit:-1},e.getCharCountIndicator=function(o,s){if(!o.ccBits)throw new Error("Invalid mode: "+o);if(!t.isValid(s))throw new Error("Invalid version: "+s);return s>=1&&s<10?o.ccBits[0]:s<27?o.ccBits[1]:o.ccBits[2]},e.getBestModeForData=function(o){return n.testNumeric(o)?e.NUMERIC:n.testAlphanumeric(o)?e.ALPHANUMERIC:n.testKanji(o)?e.KANJI:e.BYTE},e.toString=function(o){if(o&&o.id)return o.id;throw new Error("Invalid mode")},e.isValid=function(o){return o&&o.bit&&o.ccBits};function i(r){if(typeof r!="string")throw new Error("Param is not a string");switch(r.toLowerCase()){case"numeric":return e.NUMERIC;case"alphanumeric":return e.ALPHANUMERIC;case"kanji":return e.KANJI;case"byte":return e.BYTE;default:throw new Error("Unknown mode: "+r)}}e.from=function(o,s){if(e.isValid(o))return o;try{return i(o)}catch{return s}}})(Ne);(function(e){const t=we,n=Rt,i=At,r=Ne,o=pn,s=7973,a=t.getBCHDigit(s);function l(T,d,M){for(let O=1;O<=40;O++)if(d<=e.getCapacity(O,M,T))return O}function p(T,d){return r.getCharCountIndicator(T,d)+4}function w(T,d){let M=0;return T.forEach(function(O){const B=p(O.mode,d);M+=B+O.getBitsLength()}),M}function E(T,d){for(let M=1;M<=40;M++)if(w(T,M)<=e.getCapacity(M,d,r.MIXED))return M}e.from=function(d,M){return o.isValid(d)?parseInt(d,10):M},e.getCapacity=function(d,M,O){if(!o.isValid(d))throw new Error("Invalid QR Code version");typeof O>"u"&&(O=r.BYTE);const B=t.getSymbolTotalCodewords(d),h=n.getTotalCodewordsCount(d,M),g=(B-h)*8;if(O===r.MIXED)return g;const b=g-p(O,d);switch(O){case r.NUMERIC:return Math.floor(b/10*3);case r.ALPHANUMERIC:return Math.floor(b/11*2);case r.KANJI:return Math.floor(b/13);case r.BYTE:default:return Math.floor(b/8)}},e.getBestVersionForData=function(d,M){let O;const B=i.from(M,i.M);if(Array.isArray(d)){if(d.length>1)return E(d,B);if(d.length===0)return 1;O=d[0]}else O=d;return l(O.mode,O.getLength(),B)},e.getEncodedBits=function(d){if(!o.isValid(d)||d<7)throw new Error("Invalid QR Code version");let M=d<<12;for(;t.getBCHDigit(M)-a>=0;)M^=s<<t.getBCHDigit(M)-a;return d<<12|M}})(io);var so={};const on=we,lo=1335,vi=21522,kn=on.getBCHDigit(lo);so.getEncodedBits=function(t,n){const i=t.bit<<3|n;let r=i<<10;for(;on.getBCHDigit(r)-kn>=0;)r^=lo<<on.getBCHDigit(r)-kn;return(i<<10|r)^vi};var uo={};const hi=Ne;function Qe(e){this.mode=hi.NUMERIC,this.data=e.toString()}Qe.getBitsLength=function(t){return 10*Math.floor(t/3)+(t%3?t%3*3+1:0)};Qe.prototype.getLength=function(){return this.data.length};Qe.prototype.getBitsLength=function(){return Qe.getBitsLength(this.data.length)};Qe.prototype.write=function(t){let n,i,r;for(n=0;n+3<=this.data.length;n+=3)i=this.data.substr(n,3),r=parseInt(i,10),t.put(r,10);const o=this.data.length-n;o>0&&(i=this.data.substr(n),r=parseInt(i,10),t.put(r,o*3+1))};var _i=Qe;const yi=Ne,Gt=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function ze(e){this.mode=yi.ALPHANUMERIC,this.data=e}ze.getBitsLength=function(t){return 11*Math.floor(t/2)+6*(t%2)};ze.prototype.getLength=function(){return this.data.length};ze.prototype.getBitsLength=function(){return ze.getBitsLength(this.data.length)};ze.prototype.write=function(t){let n;for(n=0;n+2<=this.data.length;n+=2){let i=Gt.indexOf(this.data[n])*45;i+=Gt.indexOf(this.data[n+1]),t.put(i,11)}this.data.length%2&&t.put(Gt.indexOf(this.data[n]),6)};var wi=ze,Ci=function(t){for(var n=[],i=t.length,r=0;r<i;r++){var o=t.charCodeAt(r);if(o>=55296&&o<=56319&&i>r+1){var s=t.charCodeAt(r+1);s>=56320&&s<=57343&&(o=(o-55296)*1024+s-56320+65536,r+=1)}if(o<128){n.push(o);continue}if(o<2048){n.push(o>>6|192),n.push(o&63|128);continue}if(o<55296||o>=57344&&o<65536){n.push(o>>12|224),n.push(o>>6&63|128),n.push(o&63|128);continue}if(o>=65536&&o<=1114111){n.push(o>>18|240),n.push(o>>12&63|128),n.push(o>>6&63|128),n.push(o&63|128);continue}n.push(239,191,189)}return new Uint8Array(n).buffer};const bi=Ci,Ei=Ne;function je(e){this.mode=Ei.BYTE,typeof e=="string"&&(e=bi(e)),this.data=new Uint8Array(e)}je.getBitsLength=function(t){return t*8};je.prototype.getLength=function(){return this.data.length};je.prototype.getBitsLength=function(){return je.getBitsLength(this.data.length)};je.prototype.write=function(e){for(let t=0,n=this.data.length;t<n;t++)e.put(this.data[t],8)};var Si=je;const Ii=Ne,Pi=we;function We(e){this.mode=Ii.KANJI,this.data=e}We.getBitsLength=function(t){return t*13};We.prototype.getLength=function(){return this.data.length};We.prototype.getBitsLength=function(){return We.getBitsLength(this.data.length)};We.prototype.write=function(e){let t;for(t=0;t<this.data.length;t++){let n=Pi.toSJIS(this.data[t]);if(n>=33088&&n<=40956)n-=33088;else if(n>=57408&&n<=60351)n-=49472;else throw new Error("Invalid SJIS character: "+this.data[t]+`
Make sure your charset is UTF-8`);n=(n>>>8&255)*192+(n&255),e.put(n,13)}};var Ti=We,co={exports:{}};(function(e){var t={single_source_shortest_paths:function(n,i,r){var o={},s={};s[i]=0;var a=t.PriorityQueue.make();a.push(i,0);for(var l,p,w,E,T,d,M,O,B;!a.empty();){l=a.pop(),p=l.value,E=l.cost,T=n[p]||{};for(w in T)T.hasOwnProperty(w)&&(d=T[w],M=E+d,O=s[w],B=typeof s[w]>"u",(B||O>M)&&(s[w]=M,a.push(w,M),o[w]=p))}if(typeof r<"u"&&typeof s[r]>"u"){var h=["Could not find a path from ",i," to ",r,"."].join("");throw new Error(h)}return o},extract_shortest_path_from_predecessor_list:function(n,i){for(var r=[],o=i;o;)r.push(o),n[o],o=n[o];return r.reverse(),r},find_path:function(n,i,r){var o=t.single_source_shortest_paths(n,i,r);return t.extract_shortest_path_from_predecessor_list(o,r)},PriorityQueue:{make:function(n){var i=t.PriorityQueue,r={},o;n=n||{};for(o in i)i.hasOwnProperty(o)&&(r[o]=i[o]);return r.queue=[],r.sorter=n.sorter||i.default_sorter,r},default_sorter:function(n,i){return n.cost-i.cost},push:function(n,i){var r={value:n,cost:i};this.queue.push(r),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};e.exports=t})(co);var Ai=co.exports;(function(e){const t=Ne,n=_i,i=wi,r=Si,o=Ti,s=Ae,a=we,l=Ai;function p(h){return unescape(encodeURIComponent(h)).length}function w(h,g,b){const I=[];let k;for(;(k=h.exec(b))!==null;)I.push({data:k[0],index:k.index,mode:g,length:k[0].length});return I}function E(h){const g=w(s.NUMERIC,t.NUMERIC,h),b=w(s.ALPHANUMERIC,t.ALPHANUMERIC,h);let I,k;return a.isKanjiModeEnabled()?(I=w(s.BYTE,t.BYTE,h),k=w(s.KANJI,t.KANJI,h)):(I=w(s.BYTE_KANJI,t.BYTE,h),k=[]),g.concat(b,I,k).sort(function(_,S){return _.index-S.index}).map(function(_){return{data:_.data,mode:_.mode,length:_.length}})}function T(h,g){switch(g){case t.NUMERIC:return n.getBitsLength(h);case t.ALPHANUMERIC:return i.getBitsLength(h);case t.KANJI:return o.getBitsLength(h);case t.BYTE:return r.getBitsLength(h)}}function d(h){return h.reduce(function(g,b){const I=g.length-1>=0?g[g.length-1]:null;return I&&I.mode===b.mode?(g[g.length-1].data+=b.data,g):(g.push(b),g)},[])}function M(h){const g=[];for(let b=0;b<h.length;b++){const I=h[b];switch(I.mode){case t.NUMERIC:g.push([I,{data:I.data,mode:t.ALPHANUMERIC,length:I.length},{data:I.data,mode:t.BYTE,length:I.length}]);break;case t.ALPHANUMERIC:g.push([I,{data:I.data,mode:t.BYTE,length:I.length}]);break;case t.KANJI:g.push([I,{data:I.data,mode:t.BYTE,length:p(I.data)}]);break;case t.BYTE:g.push([{data:I.data,mode:t.BYTE,length:p(I.data)}])}}return g}function O(h,g){const b={},I={start:{}};let k=["start"];for(let F=0;F<h.length;F++){const _=h[F],S=[];for(let v=0;v<_.length;v++){const P=_[v],U=""+F+v;S.push(U),b[U]={node:P,lastCount:0},I[U]={};for(let Q=0;Q<k.length;Q++){const H=k[Q];b[H]&&b[H].node.mode===P.mode?(I[H][U]=T(b[H].lastCount+P.length,P.mode)-T(b[H].lastCount,P.mode),b[H].lastCount+=P.length):(b[H]&&(b[H].lastCount=P.length),I[H][U]=T(P.length,P.mode)+4+t.getCharCountIndicator(P.mode,g))}}k=S}for(let F=0;F<k.length;F++)I[k[F]].end=0;return{map:I,table:b}}function B(h,g){let b;const I=t.getBestModeForData(h);if(b=t.from(g,I),b!==t.BYTE&&b.bit<I.bit)throw new Error('"'+h+'" cannot be encoded with mode '+t.toString(b)+`.
 Suggested mode is: `+t.toString(I));switch(b===t.KANJI&&!a.isKanjiModeEnabled()&&(b=t.BYTE),b){case t.NUMERIC:return new n(h);case t.ALPHANUMERIC:return new i(h);case t.KANJI:return new o(h);case t.BYTE:return new r(h)}}e.fromArray=function(g){return g.reduce(function(b,I){return typeof I=="string"?b.push(B(I,null)):I.data&&b.push(B(I.data,I.mode)),b},[])},e.fromString=function(g,b){const I=E(g,a.isKanjiModeEnabled()),k=M(I),F=O(k,b),_=l.find_path(F.map,"start","end"),S=[];for(let v=1;v<_.length-1;v++)S.push(F.table[_[v]].node);return e.fromArray(d(S))},e.rawSplit=function(g){return e.fromArray(E(g,a.isKanjiModeEnabled()))}})(uo);const Dt=we,Jt=At,Ri=si,ki=li,Di=eo,Li=to,rn=no,an=Rt,Bi=ci,wt=io,Ni=so,Mi=Ne,Yt=uo;function Oi(e,t){const n=e.size,i=Li.getPositions(t);for(let r=0;r<i.length;r++){const o=i[r][0],s=i[r][1];for(let a=-1;a<=7;a++)if(!(o+a<=-1||n<=o+a))for(let l=-1;l<=7;l++)s+l<=-1||n<=s+l||(a>=0&&a<=6&&(l===0||l===6)||l>=0&&l<=6&&(a===0||a===6)||a>=2&&a<=4&&l>=2&&l<=4?e.set(o+a,s+l,!0,!0):e.set(o+a,s+l,!1,!0))}}function Fi(e){const t=e.size;for(let n=8;n<t-8;n++){const i=n%2===0;e.set(n,6,i,!0),e.set(6,n,i,!0)}}function $i(e,t){const n=Di.getPositions(t);for(let i=0;i<n.length;i++){const r=n[i][0],o=n[i][1];for(let s=-2;s<=2;s++)for(let a=-2;a<=2;a++)s===-2||s===2||a===-2||a===2||s===0&&a===0?e.set(r+s,o+a,!0,!0):e.set(r+s,o+a,!1,!0)}}function Ui(e,t){const n=e.size,i=wt.getEncodedBits(t);let r,o,s;for(let a=0;a<18;a++)r=Math.floor(a/3),o=a%3+n-8-3,s=(i>>a&1)===1,e.set(r,o,s,!0),e.set(o,r,s,!0)}function xt(e,t,n){const i=e.size,r=Ni.getEncodedBits(t,n);let o,s;for(o=0;o<15;o++)s=(r>>o&1)===1,o<6?e.set(o,8,s,!0):o<8?e.set(o+1,8,s,!0):e.set(i-15+o,8,s,!0),o<8?e.set(8,i-o-1,s,!0):o<9?e.set(8,15-o-1+1,s,!0):e.set(8,15-o-1,s,!0);e.set(i-8,8,1,!0)}function Vi(e,t){const n=e.size;let i=-1,r=n-1,o=7,s=0;for(let a=n-1;a>0;a-=2)for(a===6&&a--;;){for(let l=0;l<2;l++)if(!e.isReserved(r,a-l)){let p=!1;s<t.length&&(p=(t[s]>>>o&1)===1),e.set(r,a-l,p),o--,o===-1&&(s++,o=7)}if(r+=i,r<0||n<=r){r-=i,i=-i;break}}}function qi(e,t,n){const i=new Ri;n.forEach(function(l){i.put(l.mode.bit,4),i.put(l.getLength(),Mi.getCharCountIndicator(l.mode,e)),l.write(i)});const r=Dt.getSymbolTotalCodewords(e),o=an.getTotalCodewordsCount(e,t),s=(r-o)*8;for(i.getLengthInBits()+4<=s&&i.put(0,4);i.getLengthInBits()%8!==0;)i.putBit(0);const a=(s-i.getLengthInBits())/8;for(let l=0;l<a;l++)i.put(l%2?17:236,8);return Hi(i,e,t)}function Hi(e,t,n){const i=Dt.getSymbolTotalCodewords(t),r=an.getTotalCodewordsCount(t,n),o=i-r,s=an.getBlocksCount(t,n),a=i%s,l=s-a,p=Math.floor(i/s),w=Math.floor(o/s),E=w+1,T=p-w,d=new Bi(T);let M=0;const O=new Array(s),B=new Array(s);let h=0;const g=new Uint8Array(e.buffer);for(let _=0;_<s;_++){const S=_<l?w:E;O[_]=g.slice(M,M+S),B[_]=d.encode(O[_]),M+=S,h=Math.max(h,S)}const b=new Uint8Array(i);let I=0,k,F;for(k=0;k<h;k++)for(F=0;F<s;F++)k<O[F].length&&(b[I++]=O[F][k]);for(k=0;k<T;k++)for(F=0;F<s;F++)b[I++]=B[F][k];return b}function Ki(e,t,n,i){let r;if(Array.isArray(e))r=Yt.fromArray(e);else if(typeof e=="string"){let p=t;if(!p){const w=Yt.rawSplit(e);p=wt.getBestVersionForData(w,n)}r=Yt.fromString(e,p||40)}else throw new Error("Invalid data");const o=wt.getBestVersionForData(r,n);if(!o)throw new Error("The amount of data is too big to be stored in a QR Code");if(!t)t=o;else if(t<o)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+o+`.
`);const s=qi(t,n,r),a=Dt.getSymbolSize(t),l=new ki(a);return Oi(l,t),Fi(l),$i(l,t),xt(l,n,0),t>=7&&Ui(l,t),Vi(l,s),isNaN(i)&&(i=rn.getBestMask(l,xt.bind(null,l,n))),rn.applyMask(i,l),xt(l,n,i),{modules:l,version:t,errorCorrectionLevel:n,maskPattern:i,segments:r}}Xn.create=function(t,n){if(typeof t>"u"||t==="")throw new Error("No input text");let i=Jt.M,r,o;return typeof n<"u"&&(i=Jt.from(n.errorCorrectionLevel,Jt.M),r=wt.from(n.version),o=rn.from(n.maskPattern),n.toSJISFunc&&Dt.setToSJISFunction(n.toSJISFunc)),Ki(t,r,i,o)};var fo={},vn={};(function(e){function t(n){if(typeof n=="number"&&(n=n.toString()),typeof n!="string")throw new Error("Color should be defined as hex string");let i=n.slice().replace("#","").split("");if(i.length<3||i.length===5||i.length>8)throw new Error("Invalid hex color: "+n);(i.length===3||i.length===4)&&(i=Array.prototype.concat.apply([],i.map(function(o){return[o,o]}))),i.length===6&&i.push("F","F");const r=parseInt(i.join(""),16);return{r:r>>24&255,g:r>>16&255,b:r>>8&255,a:r&255,hex:"#"+i.slice(0,6).join("")}}e.getOptions=function(i){i||(i={}),i.color||(i.color={});const r=typeof i.margin>"u"||i.margin===null||i.margin<0?4:i.margin,o=i.width&&i.width>=21?i.width:void 0,s=i.scale||4;return{width:o,scale:o?4:s,margin:r,color:{dark:t(i.color.dark||"#000000ff"),light:t(i.color.light||"#ffffffff")},type:i.type,rendererOpts:i.rendererOpts||{}}},e.getScale=function(i,r){return r.width&&r.width>=i+r.margin*2?r.width/(i+r.margin*2):r.scale},e.getImageWidth=function(i,r){const o=e.getScale(i,r);return Math.floor((i+r.margin*2)*o)},e.qrToImageData=function(i,r,o){const s=r.modules.size,a=r.modules.data,l=e.getScale(s,o),p=Math.floor((s+o.margin*2)*l),w=o.margin*l,E=[o.color.light,o.color.dark];for(let T=0;T<p;T++)for(let d=0;d<p;d++){let M=(T*p+d)*4,O=o.color.light;if(T>=w&&d>=w&&T<p-w&&d<p-w){const B=Math.floor((T-w)/l),h=Math.floor((d-w)/l);O=E[a[B*s+h]?1:0]}i[M++]=O.r,i[M++]=O.g,i[M++]=O.b,i[M]=O.a}}})(vn);(function(e){const t=vn;function n(r,o,s){r.clearRect(0,0,o.width,o.height),o.style||(o.style={}),o.height=s,o.width=s,o.style.height=s+"px",o.style.width=s+"px"}function i(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}e.render=function(o,s,a){let l=a,p=s;typeof l>"u"&&(!s||!s.getContext)&&(l=s,s=void 0),s||(p=i()),l=t.getOptions(l);const w=t.getImageWidth(o.modules.size,l),E=p.getContext("2d"),T=E.createImageData(w,w);return t.qrToImageData(T.data,o,l),n(E,p,w),E.putImageData(T,0,0),p},e.renderToDataURL=function(o,s,a){let l=a;typeof l>"u"&&(!s||!s.getContext)&&(l=s,s=void 0),l||(l={});const p=e.render(o,s,l),w=l.type||"image/png",E=l.rendererOpts||{};return p.toDataURL(w,E.quality)}})(fo);var mo={};const Qi=vn;function Dn(e,t){const n=e.a/255,i=t+'="'+e.hex+'"';return n<1?i+" "+t+'-opacity="'+n.toFixed(2).slice(1)+'"':i}function Xt(e,t,n){let i=e+t;return typeof n<"u"&&(i+=" "+n),i}function zi(e,t,n){let i="",r=0,o=!1,s=0;for(let a=0;a<e.length;a++){const l=Math.floor(a%t),p=Math.floor(a/t);!l&&!o&&(o=!0),e[a]?(s++,a>0&&l>0&&e[a-1]||(i+=o?Xt("M",l+n,.5+p+n):Xt("m",r,0),r=0,o=!1),l+1<t&&e[a+1]||(i+=Xt("h",s),s=0)):r++}return i}mo.render=function(t,n,i){const r=Qi.getOptions(n),o=t.modules.size,s=t.modules.data,a=o+r.margin*2,l=r.color.light.a?"<path "+Dn(r.color.light,"fill")+' d="M0 0h'+a+"v"+a+'H0z"/>':"",p="<path "+Dn(r.color.dark,"stroke")+' d="'+zi(s,o,r.margin)+'"/>',w='viewBox="0 0 '+a+" "+a+'"',T='<svg xmlns="http://www.w3.org/2000/svg" '+(r.width?'width="'+r.width+'" height="'+r.width+'" ':"")+w+' shape-rendering="crispEdges">'+l+p+`</svg>
`;return typeof i=="function"&&i(null,T),T};const ji=ii,sn=Xn,go=fo,Wi=mo;function hn(e,t,n,i,r){const o=[].slice.call(arguments,1),s=o.length,a=typeof o[s-1]=="function";if(!a&&!ji())throw new Error("Callback required as last argument");if(a){if(s<2)throw new Error("Too few arguments provided");s===2?(r=n,n=t,t=i=void 0):s===3&&(t.getContext&&typeof r>"u"?(r=i,i=void 0):(r=i,i=n,n=t,t=void 0))}else{if(s<1)throw new Error("Too few arguments provided");return s===1?(n=t,t=i=void 0):s===2&&!t.getContext&&(i=n,n=t,t=void 0),new Promise(function(l,p){try{const w=sn.create(n,i);l(e(w,t,i))}catch(w){p(w)}})}try{const l=sn.create(n,i);r(null,e(l,t,i))}catch(l){r(l)}}lt.create=sn.create;lt.toCanvas=hn.bind(null,go.render);lt.toDataURL=hn.bind(null,go.renderToDataURL);lt.toString=hn.bind(null,function(e,t,n){return Wi.render(e,n)});const Gi={class:"container"},Ji={class:"content"},Yi=Ee({__name:"qrCode",props:{inputText:String},setup(e){const t=e,n=J(null);dn(()=>i(t.inputText||""));async function i(r){t.inputText&&await lt.toCanvas(n.value,t.inputText,{width:256})}return(r,o)=>(L(),Y("div",Gi,[pe("div",Ji,[pe("canvas",{ref_key:"canvas",ref:n},null,512),pe("h5",null,se(e.inputText),1)])]))}}),xi=Ue(Yi,[["__scopeId","data-v-93308ab6"]]),Xi=Ee({__name:"generateQrCodeButton",props:{config:{},type:{}},setup(e){const t=e,n=J(!1),i=o=>n.value=o,r=X(()=>t.config.data?Nr(t.config.data,t.type):"Please load a device ðŸ”Œ");return(o,s)=>{const a=Pe,l=Re,p=$e,w=Je,E=Ye,T=xi,d=xe,M=Xe,O=at,B=st;return L(),Y(Z,null,[u(l,{onClick:s[0]||(s[0]=h=>i(!0)),fill:"clear",color:"light",title:"Provision device",disabled:!o.config.data},{default:m(()=>[u(a,{slot:"icon-only",color:"tertiary",icon:"ioniconsRocket"in o?o.ioniconsRocket:c(Qn)},null,8,["icon"])]),_:1},8,["disabled"]),u(B,{"is-open":c(n),onWillDismiss:s[3]||(s[3]=h=>i(!1))},{default:m(()=>[u(E,null,{default:m(()=>[u(w,null,{default:m(()=>[u(p,null,{default:m(()=>[q("QR Code for Wi-Fi Provisioning")]),_:1}),u(l,{onClick:s[1]||(s[1]=h=>i(!1)),slot:"end",fill:"default"},{default:m(()=>[u(a,{icon:"ioniconsClose"in o?o.ioniconsClose:c(it),size:"medium"},null,8,["icon"])]),_:1})]),_:1})]),_:1}),u(d,null,{default:m(()=>[u(T,{"input-text":c(r)},null,8,["input-text"])]),_:1}),u(O,null,{default:m(()=>[u(w,null,{default:m(()=>[u(M,{slot:"end"},{default:m(()=>[u(l,{color:"primary",strong:!0,onClick:s[2]||(s[2]=h=>i(!1))},{default:m(()=>[q(" Close ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["is-open"])],64)}}}),Zi=Ee({__name:"resetButton",props:{modelValue:{}},setup(e){const t=e;function n(){t.modelValue.data=null,t.modelValue.qrCode=""}return(i,r)=>{const o=Pe,s=Re;return L(),z(s,{onClick:n,fill:"clear",color:"light",title:"Reset state"},{default:m(()=>[u(o,{slot:"icon-only",color:"medium",icon:"ioniconsBackspace"in i?i.ioniconsBackspace:c(bt)},null,8,["icon"])]),_:1})}}}),ea=Ee({__name:"statusIcon",props:{status:{}},setup(e){const t=new Map([[ie.IDLE,{icon:rr,color:"light"}],[ie.SKIPPED,{icon:ir,color:"medium"}],[ie.RUNNING,{icon:ar,color:"secondary"}],[ie.SUCCESS,{icon:sr,color:"success"}],[ie.WARNING,{icon:lr,color:"warning"}],[ie.ERROR,{icon:ur,color:"danger"}]]);return(n,i)=>{var o,s;const r=Pe;return L(),Y("div",{class:cr({pulse:n.status===c(ie).RUNNING})},[u(r,{icon:(o=c(t).get(n.status))==null?void 0:o.icon,color:(s=c(t).get(n.status))==null?void 0:s.color,title:n.status,size:"large"},null,8,["icon","color","title"])],2)}}}),ta=Ue(ea,[["__scopeId","data-v-b6ffdb7d"]]);/*!
 * (C) Ionic http://ionicframework.com - MIT License
 */var Ln=typeof window<"u"?window:void 0,Zt=typeof document<"u"?document:void 0,en,na=function(e){if(en===void 0){var t=e.style.animationName!==void 0,n=e.style.webkitAnimationName!==void 0;en=!t&&n?"-webkit-":""}return en},tn=function(e,t,n){var i=t.startsWith("animation")?na(e):"";e.style.setProperty(i+t,n)},pt=function(e,t){if(e===void 0&&(e=[]),t!==void 0){var n=Array.isArray(t)?t:[t];return Oe(Oe([],e,!0),n,!0)}return e},Fe=function(e){var t,n,i,r,o,s,a=[],l=[],p=[],w=!1,E,T={},d=[],M=[],O={},B=0,h=!1,g=!1,b,I,k,F=!0,_=!1,S=!0,v,P=!1,U=e,Q=[],H=[],C=[],y=[],R=[],j=[],G=[],ee=[],de=[],he=[],A=[],$=typeof AnimationEffect=="function"||Ln!==void 0&&typeof Ln.AnimationEffect=="function",V=typeof Element=="function"&&typeof Element.prototype.animate=="function"&&$,ae=function(){return A},x=function(f){return R.forEach(function(D){D.destroy(f)}),oe(f),y.length=0,R.length=0,a.length=0,re(),w=!1,S=!0,v},oe=function(f){Te(),f&&Lt()},te=function(){h=!1,g=!1,S=!0,b=void 0,I=void 0,k=void 0,B=0,_=!1,F=!0,P=!1},Se=function(){return B!==0&&!P},Ie=function(f,D){var K=D.findIndex(function(W){return W.c===f});K>-1&&D.splice(K,1)},ke=function(f,D){return C.push({c:f,o:D}),v},N=function(f,D){var K=D!=null&&D.oneTimeCallback?H:Q;return K.push({c:f,o:D}),v},re=function(){return Q.length=0,H.length=0,v},Te=function(){V&&(A.forEach(function(f){f.cancel()}),A.length=0)},Lt=function(){j.forEach(function(f){f!=null&&f.parentNode&&f.parentNode.removeChild(f)}),j.length=0},Bt=function(f){return G.push(f),v},ct=function(f){return ee.push(f),v},Nt=function(f){return de.push(f),v},Mt=function(f){return he.push(f),v},Ot=function(f){return l=pt(l,f),v},Ft=function(f){return p=pt(p,f),v},$t=function(f){return f===void 0&&(f={}),T=f,v},Ut=function(f){f===void 0&&(f=[]);for(var D=0,K=f;D<K.length;D++){var W=K[D];T[W]=""}return v},Ce=function(f){return d=pt(d,f),v},me=function(f){return M=pt(M,f),v},Vt=function(f){return f===void 0&&(f={}),O=f,v},Ze=function(f){f===void 0&&(f=[]);for(var D=0,K=f;D<K.length;D++){var W=K[D];O[W]=""}return v},qt=function(){return o!==void 0?o:E?E.getFill():"both"},dt=function(){return b!==void 0?b:s!==void 0?s:E?E.getDirection():"normal"},Ht=function(){return h?"linear":i!==void 0?i:E?E.getEasing():"linear"},Ve=function(){return g?0:I!==void 0?I:n!==void 0?n:E?E.getDuration():0},Kt=function(){return r!==void 0?r:E?E.getIterations():1},Qt=function(){return k!==void 0?k:t!==void 0?t:E?E.getDelay():0},_o=function(){return a},yo=function(f){return s=f,be(!0),v},wo=function(f){return o=f,be(!0),v},Co=function(f){return t=f,be(!0),v},bo=function(f){return i=f,be(!0),v},Eo=function(f){return!V&&f===0&&(f=1),n=f,be(!0),v},So=function(f){return r=f,be(!0),v},Io=function(f){return E=f,v},Po=function(f){if(f!=null)if(f.nodeType===1)y.push(f);else if(f.length>=0)for(var D=0;D<f.length;D++)y.push(f[D]);else console.error("Invalid addElement value");return v},To=function(f){if(f!=null)if(Array.isArray(f))for(var D=0,K=f;D<K.length;D++){var W=K[D];W.parent(v),R.push(W)}else f.parent(v),R.push(f);return v},Ao=function(f){var D=a!==f;return a=f,D&&Ro(a),v},Ro=function(f){V&&ae().forEach(function(D){var K=D.effect;if(K.setKeyframes)K.setKeyframes(f);else{var W=new KeyframeEffect(K.target,f,K.getTiming());D.effect=W}})},ko=function(){G.forEach(function(W){return W()}),ee.forEach(function(W){return W()});var f=l,D=p,K=T;y.forEach(function(W){var fe=W.classList;f.forEach(function(Me){return fe.add(Me)}),D.forEach(function(Me){return fe.remove(Me)});for(var qe in K)K.hasOwnProperty(qe)&&tn(W,qe,K[qe])})},Do=function(){de.forEach(function(fe){return fe()}),he.forEach(function(fe){return fe()});var f=F?1:0,D=d,K=M,W=O;y.forEach(function(fe){var qe=fe.classList;D.forEach(function(zt){return qe.add(zt)}),K.forEach(function(zt){return qe.remove(zt)});for(var Me in W)W.hasOwnProperty(Me)&&tn(fe,Me,W[Me])}),I=void 0,b=void 0,k=void 0,Q.forEach(function(fe){return fe.c(f,v)}),H.forEach(function(fe){return fe.c(f,v)}),H.length=0,S=!0,F&&(_=!0),F=!0},ft=function(){B!==0&&(B--,B===0&&(Do(),E&&E.animationFinish()))},Lo=function(){y.forEach(function(f){var D=f.animate(a,{id:U,delay:Qt(),duration:Ve(),easing:Ht(),iterations:Kt(),fill:qt(),direction:dt()});D.pause(),A.push(D)}),A.length>0&&(A[0].onfinish=function(){ft()})},wn=function(){ko(),a.length>0&&V&&Lo(),w=!0},et=function(f){f=Math.min(Math.max(f,0),.9999),V&&A.forEach(function(D){D.currentTime=D.effect.getComputedTiming().delay+Ve()*f,D.pause()})},Cn=function(f){A.forEach(function(D){D.effect.updateTiming({delay:Qt(),duration:Ve(),easing:Ht(),iterations:Kt(),fill:qt(),direction:dt()})}),f!==void 0&&et(f)},be=function(f,D,K){return f===void 0&&(f=!1),D===void 0&&(D=!0),f&&R.forEach(function(W){W.update(f,D,K)}),V&&Cn(K),v},Bo=function(f,D){return f===void 0&&(f=!1),R.forEach(function(K){K.progressStart(f,D)}),bn(),h=f,w||wn(),be(!1,!0,D),v},No=function(f){return R.forEach(function(D){D.progressStep(f)}),et(f),v},Mo=function(f,D,K){return h=!1,R.forEach(function(W){W.progressEnd(f,D,K)}),K!==void 0&&(I=K),_=!1,F=!0,f===0?(b=dt()==="reverse"?"normal":"reverse",b==="reverse"&&(F=!1),V?(be(),et(1-D)):(k=(1-D)*Ve()*-1,be(!1,!1))):f===1&&(V?(be(),et(D)):(k=D*Ve()*-1,be(!1,!1))),f!==void 0&&!E&&En(),v},bn=function(){w&&(V?A.forEach(function(f){f.pause()}):y.forEach(function(f){tn(f,"animation-play-state","paused")}),P=!0)},Oo=function(){return R.forEach(function(f){f.pause()}),bn(),v},Fo=function(){ft()},$o=function(){A.forEach(function(f){f.play()}),(a.length===0||y.length===0)&&ft()},Uo=function(){V&&(et(0),Cn())},En=function(f){return new Promise(function(D){f!=null&&f.sync&&(g=!0,N(function(){return g=!1},{oneTimeCallback:!0})),w||wn(),_&&(Uo(),_=!1),S&&(B=R.length+1,S=!1);var K=function(){Ie(W,H),D()},W=function(){Ie(K,C),D()};N(W,{oneTimeCallback:!0}),ke(K,{oneTimeCallback:!0}),R.forEach(function(fe){fe.play()}),V?$o():Fo(),P=!1})},Vo=function(){R.forEach(function(f){f.stop()}),w&&(Te(),w=!1),te(),C.forEach(function(f){return f.c(0,v)}),C.length=0},Sn=function(f,D){var K,W=a[0];return W!==void 0&&(W.offset===void 0||W.offset===0)?W[f]=D:a=Oe([(K={offset:0},K[f]=D,K)],a,!0),v},qo=function(f,D){var K,W=a[a.length-1];return W!==void 0&&(W.offset===void 0||W.offset===1)?W[f]=D:a=Oe(Oe([],a,!0),[(K={offset:1},K[f]=D,K)],!1),v},Ho=function(f,D,K){return Sn(f,D).to(f,K)};return v={parentAnimation:E,elements:y,childAnimations:R,id:U,animationFinish:ft,from:Sn,to:qo,fromTo:Ho,parent:Io,play:En,pause:Oo,stop:Vo,destroy:x,keyframes:Ao,addAnimation:To,addElement:Po,update:be,fill:wo,direction:yo,iterations:So,duration:Eo,easing:bo,delay:Co,getWebAnimations:ae,getKeyframes:_o,getFill:qt,getDirection:dt,getDelay:Qt,getIterations:Kt,getEasing:Ht,getDuration:Ve,afterAddRead:Nt,afterAddWrite:Mt,afterClearStyles:Ze,afterStyles:Vt,afterRemoveClass:me,afterAddClass:Ce,beforeAddRead:Bt,beforeAddWrite:ct,beforeClearStyles:Ut,beforeStyles:$t,beforeRemoveClass:Ft,beforeAddClass:Ot,onFinish:N,isRunning:Se,progressStart:Bo,progressStep:No,progressEnd:Mo}},oa=Object.defineProperty,ra=function(e,t){for(var n in t)oa(e,n,{get:t[n],enumerable:!0})},ia={};ra(ia,{err:function(){return po},map:function(){return aa},ok:function(){return ln},unwrap:function(){return sa},unwrapErr:function(){return la}});var ln=function(e){return{isOk:!0,isErr:!1,value:e}},po=function(e){return{isOk:!1,isErr:!0,value:e}};function aa(e,t){if(e.isOk){var n=t(e.value);return n instanceof Promise?n.then(function(r){return ln(r)}):ln(n)}if(e.isErr){var i=e.value;return po(i)}throw"should never get here"}var sa=function(e){if(e.isOk)return e.value;throw e.value},la=function(e){if(e.isErr)return e.value;throw e.value},ua=function(e){return da(e).$},ca=new WeakMap,da=function(e){return ca.get(e)},fa=typeof window<"u"?window:{},ma=fa.document||{head:{}};(function(){var e=!1;try{ma.addEventListener("e",null,Object.defineProperty({},"passive",{get:function(){e=!0}}))}catch{}return e})();(function(){try{return new CSSStyleSheet,typeof new CSSStyleSheet().replaceSync=="function"}catch{}return!1})();/*!
 * (C) Ionic http://ionicframework.com - MIT License
 */var ga,_n=function(e){return e&&ua(e)||ga};/*!
 * (C) Ionic http://ionicframework.com - MIT License
 */var Bn=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return console.warn.apply(console,Oe(["[Ionic Warning]: ".concat(e)],t,!1))},vo=function(e,t){e.componentOnReady?e.componentOnReady().then(function(n){return t(n)}):pa(function(){return t(e)})},pa=function(e){return typeof __zone_symbol__requestAnimationFrame=="function"?__zone_symbol__requestAnimationFrame(e):typeof requestAnimationFrame=="function"?requestAnimationFrame(e):setTimeout(e)},va=99,yn=function(e){return Fe().duration(e?400:300)},ha=function(e){var t,n,i=e.width+8,r=Fe(),o=Fe();e.isEndSide?(t=i+"px",n="0px"):(t=-i+"px",n="0px"),r.addElement(e.menuInnerEl).fromTo("transform","translateX(".concat(t,")"),"translateX(".concat(n,")"));var s=_n(e),a=s==="ios",l=a?.2:.25;return o.addElement(e.backdropEl).fromTo("opacity",.01,l),yn(a).addAnimation([r,o])},_a=function(e){var t,n,i=_n(e),r=e.width;e.isEndSide?(t=-r+"px",n=r+"px"):(t=r+"px",n=-r+"px");var o=Fe().addElement(e.menuInnerEl).fromTo("transform","translateX(".concat(n,")"),"translateX(0px)"),s=Fe().addElement(e.contentEl).fromTo("transform","translateX(0px)","translateX(".concat(t,")")),a=Fe().addElement(e.backdropEl).fromTo("opacity",.01,.32);return yn(i==="ios").addAnimation([o,s,a])},ya=function(e){var t=_n(e),n=e.width*(e.isEndSide?-1:1)+"px",i=Fe().addElement(e.contentEl).fromTo("transform","translateX(0px)","translateX(".concat(n,")"));return yn(t==="ios").addAnimation(i)},wa=function(){var e=new Map,t=[],n=function(_){return _e(void 0,void 0,void 0,function(){var S;return ye(this,function(v){switch(v.label){case 0:return[4,p(_,!0)];case 1:return S=v.sent(),S?[2,S.open()]:[2,!1]}})})},i=function(_){return _e(void 0,void 0,void 0,function(){var S;return ye(this,function(v){switch(v.label){case 0:return[4,_!==void 0?p(_,!0):w()];case 1:return S=v.sent(),S!==void 0?[2,S.close()]:[2,!1]}})})},r=function(_){return _e(void 0,void 0,void 0,function(){var S;return ye(this,function(v){switch(v.label){case 0:return[4,p(_,!0)];case 1:return S=v.sent(),S?[2,S.toggle()]:[2,!1]}})})},o=function(_,S){return _e(void 0,void 0,void 0,function(){var v;return ye(this,function(P){switch(P.label){case 0:return[4,p(S)];case 1:return v=P.sent(),v&&(v.disabled=!_),[2,v]}})})},s=function(_,S){return _e(void 0,void 0,void 0,function(){var v;return ye(this,function(P){switch(P.label){case 0:return[4,p(S)];case 1:return v=P.sent(),v&&(v.swipeGesture=_),[2,v]}})})},a=function(_){return _e(void 0,void 0,void 0,function(){var S,S;return ye(this,function(v){switch(v.label){case 0:return _==null?[3,2]:[4,p(_)];case 1:return S=v.sent(),[2,S!==void 0&&S.isOpen()];case 2:return[4,w()];case 3:return S=v.sent(),[2,S!==void 0]}})})},l=function(_){return _e(void 0,void 0,void 0,function(){var S;return ye(this,function(v){switch(v.label){case 0:return[4,p(_)];case 1:return S=v.sent(),S?[2,!S.disabled]:[2,!1]}})})},p=function(_){for(var S=[],v=1;v<arguments.length;v++)S[v-1]=arguments[v];return _e(void 0,Oe([_],S,!0),void 0,function(P,U){var Q,H,C;return U===void 0&&(U=!1),ye(this,function(y){switch(y.label){case 0:return[4,F()];case 1:if(y.sent(),P==="start"||P==="end"){if(Q=t.filter(function(R){return R.side===P&&!R.disabled}),Q.length>=1)return Q.length>1&&U&&Bn('menuController queried for a menu on the "'.concat(P,'" side, but ').concat(Q.length," menus were found. The first menu reference will be used. If this is not the behavior you want then pass the ID of the menu instead of its side."),Q.map(function(R){return R.el})),[2,Q[0].el];if(H=t.filter(function(R){return R.side===P}),H.length>=1)return H.length>1&&U&&Bn('menuController queried for a menu on the "'.concat(P,'" side, but ').concat(H.length," menus were found. The first menu reference will be used. If this is not the behavior you want then pass the ID of the menu instead of its side."),H.map(function(R){return R.el})),[2,H[0].el]}else if(P!=null)return[2,k(function(R){return R.menuId===P})];return C=k(function(R){return!R.disabled}),C?[2,C]:[2,t.length>0?t[0].el:void 0]}})})},w=function(){return _e(void 0,void 0,void 0,function(){return ye(this,function(_){switch(_.label){case 0:return[4,F()];case 1:return _.sent(),[2,g()]}})})},E=function(){return _e(void 0,void 0,void 0,function(){return ye(this,function(_){switch(_.label){case 0:return[4,F()];case 1:return _.sent(),[2,b()]}})})},T=function(){return _e(void 0,void 0,void 0,function(){return ye(this,function(_){switch(_.label){case 0:return[4,F()];case 1:return _.sent(),[2,I()]}})})},d=function(_,S){e.set(_,S)},M=function(_){t.indexOf(_)<0&&t.push(_)},O=function(_){var S=t.indexOf(_);S>-1&&t.splice(S,1)},B=function(_,S,v){return _e(void 0,void 0,void 0,function(){var P;return ye(this,function(U){switch(U.label){case 0:return I()?[2,!1]:S?[4,w()]:[3,3];case 1:return P=U.sent(),P&&_.el!==P?[4,P.setOpen(!1,!1)]:[3,3];case 2:U.sent(),U.label=3;case 3:return[2,_._setOpen(S,v)]}})})},h=function(_,S){var v=e.get(_);if(!v)throw new Error("animation not registered");var P=v(S);return P},g=function(){return k(function(_){return _._isOpen})},b=function(){return t.map(function(_){return _.el})},I=function(){return t.some(function(_){return _.isAnimating})},k=function(_){var S=t.find(_);if(S!==void 0)return S.el},F=function(){return Promise.all(Array.from(document.querySelectorAll("ion-menu")).map(function(_){return new Promise(function(S){return vo(_,S)})}))};return d("reveal",ya),d("push",_a),d("overlay",ha),Zt==null||Zt.addEventListener("ionBackButton",function(_){var S=g();S&&_.detail.register(va,function(){return S.close()})}),{registerAnimation:d,get:p,getMenus:E,getOpen:w,isEnabled:l,swipeGesture:s,isAnimating:T,isOpen:a,enable:o,toggle:r,close:i,open:n,_getOpenSync:g,_createAnimation:h,_register:M,_unregister:O,_setOpen:B}};wa();var Ca=function(e){return{create:function(t){return ba(e,t)},dismiss:function(t,n,i){return Sa(document,t,n,e,i)},getTop:function(){return _e(this,void 0,void 0,function(){return ye(this,function(t){return[2,ho(document,e)]})})}}},vt=Ca("ion-alert"),ba=function(e,t){return typeof window<"u"&&typeof window.customElements<"u"?window.customElements.whenDefined(e).then(function(){var n=document.createElement(e);return n.classList.add("overlay-hidden"),Object.assign(n,Object.assign(Object.assign({},t),{hasController:!0})),Ta(document).appendChild(n),new Promise(function(i){return vo(n,i)})}):Promise.resolve()},Ea=function(e){return e.classList.contains("overlay-hidden")},Sa=function(e,t,n,i,r){var o=ho(e,i,r);return o?o.dismiss(t,n):Promise.reject("overlay does not exist")},Ia=function(e,t){return t===void 0&&(t="ion-alert,ion-action-sheet,ion-loading,ion-modal,ion-picker-legacy,ion-popover,ion-toast"),Array.from(e.querySelectorAll(t)).filter(function(n){return n.overlayIndex>0})},Pa=function(e,t){return Ia(e,t).filter(function(n){return!Ea(n)})},ho=function(e,t,n){var i=Pa(e,t);return n===void 0?i[i.length-1]:i.find(function(r){return r.id===n})},Ta=function(e){return e.querySelector("ion-app")||e.body};const Aa=e=>(Sr("data-v-cc8bcc30"),e=e(),Ir(),e),Ra={class:"buttons"},ka=Aa(()=>pe("th",null,null,-1)),Da={key:0},La={key:0},Ba=Ee({__name:"card",props:{control:{},config:{},index:{}},setup(e){const{newMsgId:t,request:n,ipcSubject:i}=It(Pt.IPC_FLASH),{$db:r,$api:o}=Ge(),s=Nn(),a=e,l=dr([a.config]),p=J(le.STOPPED),w=J(tt.DEFAULT),E=Ct(),T=fr();let d=null;const M=()=>({[jt.FLASH]:{[ge.BOOTLOADER]:ie.IDLE,[ge.PARTITION]:ie.IDLE,[ge.STORAGE]:ie.IDLE,[ge.OTA]:ie.IDLE,[ge.KEY]:ie.IDLE,[ge.APP]:ie.IDLE},[jt.VERIFY]:{[ge.BOOTLOADER]:ie.IDLE,[ge.PARTITION]:ie.IDLE,[ge.STORAGE]:ie.IDLE,[ge.OTA]:ie.IDLE,[ge.KEY]:ie.IDLE,[ge.APP]:ie.IDLE}}),O=J(M()),B=J(!1),h=new mr;function g(A){O.value[A.group][A.stage]=A.status}function b(A){p.value=A}const I=new TextDecoder;async function k(){if(G.value===""){await(await vt.create({header:"Warning âš ï¸",subHeader:"No camera serial port configured",message:"Please configure the com port in the config",buttons:["OK"]})).present();return}try{const A=vr(G.value),{response:$}=await A.send(hr);if($.length===0)throw new Error(`Empty response for camera in slot ${a.index+1}`);const V=I.decode($),{data:ae}=await o.deviceList({deviceListRequest:Jn(V)});if(ae.devices.length===0&&!E.value.autoCreate)throw new Error("Device not found. Check the 'auto create device' setting.");if(ae.devices.length===0&&E.value.autoCreate){const x=E.value.variantId,oe=s.value.email.split("@")[0];a.config.data=await Yn(V,x,oe);return}a.config.data=ae.devices[0]}catch(A){const{msg:$}=await An(A);await(await vt.create({header:"Error â›”",subHeader:"A problem occurred while scanning the qr code",message:$,buttons:["OK"]})).present();return}}async function F(A){const $=a.config.data;if(!ee)return;if($===null){await(await vt.create({header:"Warning âš ï¸",subHeader:"No device is loaded",message:"Please scan a device or enter the code manually",buttons:["OK"]})).present();return}const{productSerial:V}=$;if(T.value.includes(V)){await(await vt.create({header:"Flash device again? ðŸ§",animated:!0,backdropDismiss:!0,buttons:[{text:"Cancel",role:"cancel"},{text:"Flash",role:"confirm",handler:()=>{_(V,A)}}]})).present();return}await _(V,A),E.value.verifyOtp&&he.value&&await S($)}async function _(A,$){const V=a.index+1;if(E.value.firmwareReleaseId===null){await _t(new Error("No firmware selected. Check the settings"));return}if(p.value===le.STARTED){console.log(`Flash already running on slot ${V}`);return}console.log(`Starting to flash slot ${V}`),v(),O.value=M(),p.value=le.STARTED;const ae=R.getBySerial(E.value.comPortFlashModeController),x={type:ve.FLASH_START_REQUEST,id:t(),deviceType:C.value,comPortOrDeviceId:ee.value,comPortFlashModeController:ae,flashModeController:E.value.flashModeController,productSerial:A,stage:$,productionMode:E.value.productionMode,eraseBeforeFlash:E.value.eraseBeforeFlash,retryWithoutOtp:E.value.retryWithoutOtp,flashSpeed:E.value.flashSpeed,slotId:a.index,dryRun:E.value.dryRun,plcMode:E.value.plcMode},oe=i.pipe(qn(te=>te.id===x.id),jr(h),Hn(te=>{if(te.type===ve.ERROR_RESPONSE)throw new Error(te.reason)}));d=oe.subscribe({next:te=>{switch(te.type){case ve.FLASH_LOG_UPDATE:r.deviceLogs.add({level:te.level,productSerial:A,message:te.message,timestamp:new Date().toISOString()});break;case ve.FLASH_STATE_UPDATE:b(te.state),te.state===le.SUCCEEDED&&(T.value.push(A),h.next(!0));break;case ve.FLASH_STATUS_UPDATE:g(te.status);break}},error:te=>{g({group:jt.FLASH,stage:ge.STORAGE,status:ie.ERROR}),b(le.FAILED),r.deviceLogs.add({level:Be.ERROR,productSerial:A,message:te.message,timestamp:new Date().toISOString()})}}),i.next(x),await Wr(oe)}async function S(A){B.value=!0,b(le.WARNING);const $=A.product.productCode,V=A.serialNumber,ae=A.productSerial;try{const{productCode:x,serialNumber:oe}=await n({type:ve.FLASH_TEST_REQUEST,id:t(),comPortOrDeviceId:ee.value,deviceType:C.value},6e4),te=x!==void 0&&x>0,Se=oe!==void 0&&oe>0;if(!(te&&x===$)||!(Se&&oe===V))throw new Error(`OTP mismatch! PC ${$}:${x} SN ${V} ${oe}`);b(le.SUCCEEDED)}catch(x){const{msg:oe}=await An(x);r.deviceLogs.add({level:Be.WARN,productSerial:ae,message:oe,timestamp:new Date().toISOString()});const{data:te}=await o.getTagList(),Se="OTP_VERIFY_FAILED",Ie=te.tags.filter(re=>re.name===Se),ke=async()=>{const{data:re}=await o.createTag({createTagRequest:{name:Se,description:"OTP verify after flashing failed. Not recoverable"}});return re.tag.id},N=Ie.length>0?Ie[0].id:await ke();await o.modifyDevice({modifyDeviceRequest:{productSerial:ae,deviceStatusId:_r.SCRAPPED,tagIds:[N]}})}finally{B.value=!1}}function v(){d&&(d.unsubscribe(),d=null)}function P(){p.value=le.STOPPED,h.next(!0),v()}const U=A=>y.value.stages.find($=>$.stage===A)!==void 0,Q=A=>!(A===ge.KEY&&!E.value.productionMode),H=X(()=>{var V;const A=(V=a.config.data)==null?void 0:V.product.name,$=A?`${A} âœ…`:"Unassigned Deviceâ“";return`${a.index+1}. ${$}`}),C=X(()=>Tt(a.config.data)),y=X(()=>Mr(C.value)),R=fn(),j=J(a.config.comPortSerial),G=J(a.config.comPortCamera),ee=X(()=>ot(C.value)?j.value:E.value.plcMode?a.config.comPortPlc:a.config.programmerId),de=X(()=>ot(C.value)),he=X(()=>C.value===nn.MICROCHIP);return De(()=>a.control,A=>{switch(O.value=M(),A){case ue.START:F();break;case ue.STOP:case ue.RESET:P();break;case ue.LOAD:k()}}),De(p,A=>{switch(A){case le.FAILED:w.value=tt.FLASH_NOK;break;case le.SUCCEEDED:w.value=tt.FLASH_OK;break;case le.WARNING:w.value=tt.WARNING;break;default:w.value=tt.DEFAULT}}),De(()=>a.config,A=>{O.value=M(),p.value=le.STOPPED,l.value=[a.config],j.value=R.getBySerial(A.comPortSerial),G.value=R.getBySerial(A.comPortCamera)},{deep:!0}),De(O,A=>{const $=Object.values(A),V=$.map(x=>Object.values(x).some(oe=>oe===ie.ERROR)).some(x=>x),ae=$.map(x=>Object.values(x).every(oe=>oe===ie.SUCCESS)).every(x=>x);V?p.value=le.FAILED:ae&&(p.value=le.SUCCEEDED)}),ht(()=>{v()}),(A,$)=>{const V=$e,ae=Kr,x=Qr,oe=yr,te=zr,Se=Pe,Ie=Re,ke=xn,N=Zr,re=ni,Te=ri,Lt=Xi,Bt=Zi,ct=wr,Nt=Wn,Mt=ta,Ot=Gn,Ft=Cr,$t=br,Ut=Er;return L(),z(Ut,{color:c(w)},{default:m(()=>[u(Ft,null,{default:m(()=>[u(Ot,null,{default:m(()=>[u(ct,null,{default:m(()=>{var Ce;return[u(V,{class:"title",title:c(C)},{default:m(()=>[q(se(c(H)),1)]),_:1},8,["title"]),u(V,{class:"subtitle",title:A.config.comPortSerial},{default:m(()=>[a.config.data?(L(),z(oe,{key:0,title:"Product Serial"},{default:m(()=>{var me;return[q(" Product Serial: "),u(x,{label:(me=a.config.data)==null?void 0:me.productSerial},{default:m(()=>[u(ae,{label:"Copy",icon:"ioniconsCopy"in A?A.ioniconsCopy:c(gr),action:"copy"},null,8,["icon"]),u(ae,{label:"Query Device",icon:"ioniconsSearch"in A?A.ioniconsSearch:c(pr),action:"lookup",default:""},null,8,["icon"])]),_:1},8,["label"])]}),_:1})):(L(),z(oe,{key:1,title:"Please scan the QR code"},{default:m(()=>[q(" Please scan the QR code ")]),_:1}))]),_:1},8,["title"]),a.config.data?(L(),z(V,{key:0,class:"subtitle"},{default:m(()=>[q(" Serial Number: "),u(te,null,{default:m(()=>[q(se(a.config.data.serialNumber),1)]),_:1})]),_:1})):(L(),z(V,{key:1,class:"subtitle"},{default:m(()=>[q("Â ")]),_:1})),pe("div",Ra,[c(p)!==c(le).STARTED?(L(),z(Ie,{key:0,onClick:$[0]||($[0]=me=>F()),color:"primary",class:"start-stop-button"},{default:m(()=>[u(Se,{slot:"start",icon:"ioniconsCaretForward"in A?A.ioniconsCaretForward:c(zn)},null,8,["icon"]),q(" Start ")]),_:1})):ne("",!0),c(p)===c(le).STARTED?(L(),z(Ie,{key:1,onClick:$[1]||($[1]=me=>P()),color:"danger",class:"start-stop-button",disabled:!A.config.data},{default:m(()=>[u(Se,{slot:"start",icon:"ioniconsStop"in A?A.ioniconsStop:c(jn)},null,8,["icon"]),q(" Stop ")]),_:1},8,["disabled"])):ne("",!0),u(ke,{devices:c(l),"onUpdate:devices":$[2]||($[2]=me=>Ke(l)?l.value=me:null),single:!0},null,8,["devices"]),u(N,{config:a.config},null,8,["config"]),u(re,{config:a.config},null,8,["config"]),u(Te,{"product-serial":((Ce=a.config.data)==null?void 0:Ce.productSerial)??a.config.comPortSerial},null,8,["product-serial"]),u(Lt,{config:a.config,type:c(de)?("QrCodeType"in A?A.QrCodeType:c(Tn)).WIFI:("QrCodeType"in A?A.QrCodeType:c(Tn)).STANDARD},null,8,["config","type"]),u(Bt,{modelValue:a.config,"onUpdate:modelValue":$[3]||($[3]=me=>a.config=me)},null,8,["modelValue"])])]}),_:1}),c(C)!==("FlashDeviceType"in A?A.FlashDeviceType:c(nn)).UNKNOWN?(L(),z(ct,{key:0},{default:m(()=>[pe("table",null,[pe("thead",null,[pe("tr",null,[ka,(L(!0),Y(Z,null,ce(c(y).stages,Ce=>(L(),Y(Z,null,[Q(Ce.stage)?(L(),Y("th",Da,[u(Nt,{title:`Flash ${Ce.stage} (${Ce.address})`,color:"primary",onClick:me=>F(Ce.stage),disabled:!A.config.data},{default:m(()=>[q(se(Ce.stage),1)]),_:2},1032,["title","onClick","disabled"])])):ne("",!0)],64))),256))])]),pe("tbody",null,[(L(!0),Y(Z,null,ce(c(O),(Ce,me)=>(L(),Y("tr",{key:me},[pe("td",null,se(me),1),(L(!0),Y(Z,null,ce(Ce,(Vt,Ze)=>(L(),Y(Z,{key:Ze},[U(Ze)&&Q(Ze)?(L(),Y("td",La,[u(Mt,{status:Vt},null,8,["status"])])):ne("",!0)],64))),128))]))),128))])])]),_:1})):ne("",!0)]),_:1})]),_:1}),c(B)?(L(),z($t,{key:0,type:"indeterminate",color:"warning"})):ne("",!0)]),_:1},8,["color"])}}}),Na=Ue(Ba,[["__scopeId","data-v-cc8bcc30"]]),Ma=Ee({__name:"flash",setup(e){const{hasRole:t}=Fn(),n=Ct(),i=$n(),r=J(ue.STOP),o=J(0);async function s(){r.value=ue.START,await He(10),r.value=ue.NOOP}async function a(){r.value=ue.STOP,await He(10),r.value=ue.NOOP}async function l(){r.value=ue.RESET,await He(10),r.value=ue.NOOP;for(const g of n.value.devices)g.qrCode="",g.data=null}async function p(){r.value=ue.LOAD,await He(10),r.value=ue.NOOP}async function w(g=6){for(let b=0;b<g;b++)if(await He(1e3),n.value.devices.every(({data:k})=>k!==null))return;throw new Error(`Not all devices were loaded after ${g} retries.`)}async function E(){try{r.value=ue.RESET,await He(10),r.value=ue.LOAD,await w(),r.value=ue.START}catch(g){await _t(g)}}function T(){n.value.productionMode=!n.value.productionMode}const d=X(()=>{if(n.value.devices.length===0)return!1;const g=n.value.devices[0].comPortSerial;return n.value.devices.every(b=>b.comPortSerial===g)}),M=X(()=>{if(n.value.devices.length===0)return!1;const g=n.value.devices[0].programmerId;return n.value.devices.every(b=>b.programmerId===g)}),O=X(()=>h.value==="gateway"?d.value:M.value),B=X(()=>{const g=i.value;if(g.length===0)return"No product selected";const b=g[0],I=b.name,k=n.value.variantId,F=b.variants.filter(v=>v.id===k),_=F.length===0?"":`v${F[0].version}`;return`${Fr(b.model)} ${I} ${_}`}),h=X(()=>i.value.length===1?i.value[0].type.name:"Unknown");return Pr("Insert",g=>{g.preventDefault(),o.value++}),dn(()=>{n.value=Or(n.value,Tr)}),(g,b)=>{const I=Rr,k=$e,F=Xe,_=Wn,S=Gn,v=Dr,P=Je,U=Ye,Q=Pe,H=Re,C=xn,y=xr,R=Na,j=xe,G=Ar;return L(),z(G,null,{default:m(()=>[u(U,null,{default:m(()=>[u(P,null,{default:m(()=>[u(F,{slot:"start"},{default:m(()=>[u(I),u(k,null,{default:m(()=>[q("Flash")]),_:1})]),_:1}),u(S,{class:"ion-justify-content-center"},{default:m(()=>[u(_,{color:c(n).productionMode?"warning":"secondary",class:"bold",onClick:b[0]||(b[0]=ee=>T())},{default:m(()=>[q(se(c(n).productionMode?"Production":"Development")+" Mode ",1)]),_:1},8,["color"])]),_:1}),u(F,{slot:"end"},{default:m(()=>[u(v)]),_:1})]),_:1})]),_:1}),u(j,{fullscreen:!0,class:"ion-padding"},{default:m(()=>[u(S,null,{default:m(()=>[u(P,null,{default:m(()=>[u(F,{slot:"start"},{default:m(()=>[c(n).cameraMode?(L(),z(H,{key:0,color:"success",onClick:E},{default:m(()=>[u(Q,{slot:"start",icon:"ioniconsRocket"in g?g.ioniconsRocket:c(Qn)},null,8,["icon"]),q(" Autostart ")]),_:1})):ne("",!0),c(n).cameraMode?(L(),z(H,{key:1,color:"primary",onClick:p},{default:m(()=>[u(Q,{slot:"start",icon:"ioniconsCamera"in g?g.ioniconsCamera:c(kr)},null,8,["icon"]),q(" Load ")]),_:1})):ne("",!0),u(H,{color:"primary",onClick:s,disabled:c(O)},{default:m(()=>[u(Q,{color:"secondary",slot:"start",icon:"ioniconsCaretForward"in g?g.ioniconsCaretForward:c(zn)},null,8,["icon"]),q(" Start ")]),_:1},8,["disabled"]),u(H,{color:"danger",onClick:a},{default:m(()=>[u(Q,{slot:"start",icon:"ioniconsStop"in g?g.ioniconsStop:c(jn)},null,8,["icon"]),q(" Stop ")]),_:1}),u(H,{color:"medium",onClick:l},{default:m(()=>[u(Q,{slot:"start",icon:"ioniconsBackspace"in g?g.ioniconsBackspace:c(bt)},null,8,["icon"]),q(" Clear ")]),_:1})]),_:1}),u(S,{class:"ion-justify-content-center"},{default:m(()=>[pe("div",null,[u(k,null,{default:m(()=>[q(se(c(B)),1)]),_:1})])]),_:1}),u(F,{slot:"end"},{default:m(()=>[u(C,{devices:c(n).devices,"onUpdate:devices":b[1]||(b[1]=ee=>c(n).devices=ee),"toggle-open":c(o),single:!1},null,8,["devices","toggle-open"]),c(t)("Supervisor","Developer")?(L(),z(y,{key:0})):ne("",!0)]),_:1})]),_:1})]),_:1}),(L(!0),Y(Z,null,ce(c(n).devices,(ee,de)=>(L(),z(R,{index:de,config:ee,control:c(r)},null,8,["index","config","control"]))),256))]),_:1})]),_:1})}}}),Ga=Ue(Ma,[["__scopeId","data-v-4da4e91a"]]);export{Ga as default};
